import{s as A,cg as I,bZ as Y,r as s,j as t,$ as v,G as C,af as O}from"./index-3ec7abe5.js";import{T}from"./index-b2a6305f.js";import{I as U}from"./index.esm-66734f9f.js";import{C as P,D as L}from"./dropdown.esm-1ad10373.js";import{C as S}from"./index-3d6f48ca.js";import{P as B}from"./plus-b36a0702.js";import{B as H}from"./index-36dd5a0c.js";import{G}from"./iconBase-2780a5a8.js";import{I as J}from"./index.esm-6710b6c8.js";import{C as V}from"./calendar.esm-f987a87a.js";import{L as N}from"./index-37ade0e2.js";import{f as W}from"./api-d328eb9f.js";import{c as Q}from"./index.esm-a84e9864.js";import{u as Z}from"./useDispatch-1aeda00f.js";import"./paginator.esm-634e02d4.js";import"./inputtext.esm-e49a03d7.js";import"./index.esm-9e3aa09b.js";import"./index.esm-be3d6ae7.js";const q=async l=>await I("upload/file/document",l),z=async({page:l,records:n,sortBy:d,sortOrder:c,month:a,year:u,employee_id:x,status:m})=>{console.log(">>>>>",d);const h=`document/letter?page=${l}&records=${n||10}&month=${a}&year=${u}&employee_id=${x}&sortBy=${d}&sortOrder=${c}&status=${m}`;return await A(h)},K=async l=>{const n=`document/letter/${l}`;return await Y(n)};function X(l){return G({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}}]})(l)}const ee=({visible:l,onHide:n,tableRef:d})=>{const c=s.useRef(null),[a,u]=s.useState(null),[x,m]=s.useState(!1),[h,b]=s.useState(!1),j=r=>{const i=[...r.target.files].map(p=>p);u(i)},w=async()=>{m(!0);let r=!1;const f=new FormData;if(console.log(a),a&&a.length>0){for(let i of a){const p=["pdf","docx","doc"],y=i.name.split(".");if(console.log(">>>>>>>>>>>.",y[1]),console.log(p.includes(y[1])),p.includes(y[1]))f.append("file",i);else{r=!0;break}}r?(console.log("WRROR"),v.error("You're tring to upload a file with wrong file type, please remove it and try again.")):(console.log("?>>>>",h),(await q(f)).status===200&&(u(null),v.success("Folder uploaded succesfully!"),g(),d.current.refreshListData()))}else v.error("Please select a folder to upload!");m(!1)},g=()=>{u(null),c.current.value=null,d.current.refreshListData(),n(!1),m(!1),b(!1)},D=[{label:"Upload Letters",className:"min-w-[90px]",visible:a&&a.length>0,onClick:w,loading:x}];return t.jsx(H,{header:"Upload Letters",visible:l,onHide:g,actions:D,children:t.jsxs("div",{children:[t.jsxs("div",{className:"format",children:[t.jsxs("p",{children:["File name format- ",t.jsx("span",{className:"font-semibold",children:"Letter_[EMPCODE]_[DD]-[MM]-[YYYY]_[LETTERNAME]"})]}),t.jsx("p",{className:"text-sm",children:"The underscores are important"}),t.jsx("p",{className:"text-sm",children:"Accepted File formats are: docx and pdf"})]}),t.jsxs("label",{htmlFor:"folder-upload",className:"w-full h-full mt-10 border-dashed py-11 border-black border-spacing-2 border cursor-pointer",children:[t.jsx("input",{ref:c,id:"folder-upload",type:"file",directory:"",webkitdirectory:"",onChange:r=>j(r),className:"opacity-0 absolute"}),t.jsxs("div",{className:"flex flex-col justify-center",children:[t.jsx(J,{className:"text-6xl mx-auto self-center "}),t.jsxs("p",{className:"mx-auto self-center mt-3",children:[t.jsx("span",{className:"underline",children:"Click to upload"})," a folder or file"]})]})]}),a&&a.map((r,f)=>t.jsxs("div",{className:"flex",children:[t.jsx("p",{className:"text-black",children:r.name},f),t.jsx(X,{className:"self-center mx-2 text-red-600",onClick:()=>{a.length>1?(u(a.filter(i=>i!==r)),b(!1)):(u(null),c.current.value=null)}})]}))]})})},ye=()=>{const l=s.useRef(null);Z(),s.useState(1),s.useState(10);const[n,d]=s.useState(""),[c,a]=s.useState("");s.useState(""),s.useState("");const[u,x]=s.useState(C().toDate()),[m,h]=s.useState([]),[b,j]=s.useState(""),[w,g]=s.useState(""),[D,r]=s.useState(!1),f="https://api.minhrms.com/",i=async e=>await z({page:e.page+1,records:e.rows,sortBy:e.sortField||"",sortOrder:e.sortOrder?e.sortOrder===-1?"DESC":"ASC":"",month:n||"",year:c?C(c).year():"",employee_id:b,status:w}),p=e=>{var o;return t.jsx("div",{className:"flex w-full items-center justify-center gap-3",children:t.jsx("a",{href:`${f+((o=e==null?void 0:e.document)==null?void 0:o.public_url)}`,target:"_blank",children:t.jsx(U,{className:"text-2xl cursor-pointer"})})})},y=async e=>{let o;const R=async $=>{o=await K($),o.status===200&&(v.success(o.message),l.current.refreshListData())};return O({draggable:!1,resizable:!1,message:"Do you want to delete this letter?",header:"Delete Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>R(e.id),reject:()=>{}})},F=e=>t.jsx("div",{className:"flex w-full items-center justify-center gap-3",children:t.jsx(Q,{className:"text-2xl cursor-pointer text-red-600",onClick:()=>y(e)})}),M=[{field:"employee_id",header:"Employee ID",sortable:!0,body:e=>{var o;return t.jsx("p",{children:(o=e==null?void 0:e.user)==null?void 0:o.employee_generated_id})}},{field:"name",header:"Employee name",sortable:!0,body:e=>{var o;return t.jsx("p",{children:(o=e==null?void 0:e.user)==null?void 0:o.employee_name})}},{field:"date",header:"Date",sortable:!0,body:e=>C(e==null?void 0:e.date).format("ddd, MMM DD, YYYY")},{field:"letter_type",header:"Letter Type",sortable:!0},{field:"user",header:"Approval Status",body:e=>{if(e.status==1)return t.jsx("div",{className:"border px-3 py-2 rounded-full w-fit  bg-green-500 text-white ",children:"Accepted"});if(e.status==2)return t.jsx("div",{className:"border px-3 py-2 rounded-full w-fit bg-red-500 text-white",children:"Rejected"});if(e.status==3)return t.jsx("div",{className:"border px-3 py-2 rounded-full w-fit bg-yellow-400 text-black",children:"Pending"})}},{field:"actions",align:"center",alignHeader:"center",className:"cursor-default",header:"Download",body:e=>p(e)},{field:"actions",align:"center",className:"cursor-default",header:"Action",body:e=>F(e)}],E=[{label:"Accepted",value:1},{label:"Rejected",value:2},{label:"Pending",value:3}],_=[{label:"January",value:1},{label:"February",value:2},{label:"March",value:3},{label:"April",value:4},{label:"May",value:5},{label:"June",value:6},{label:"July",value:7},{label:"August",value:8},{label:"September",value:9},{label:"October",value:10},{label:"November",value:11},{label:"December",value:12}],k=async()=>{const e=await W();h(e.status===200?e.data.data:[])};return s.useEffect(()=>{k()},[]),t.jsxs("div",{className:"flex w-full flex-col",children:[t.jsx("div",{className:"text-bold flex w-full px-2 pb-4 text-xl text-gray-600",children:"Manage Letters"}),t.jsxs(P,{className:"flex w-full flex-col",children:[t.jsxs("div",{className:"my-2 flex flex-col-reverse justify-between gap-3 p-3 md:flex-row",children:[t.jsxs("div",{className:"flex flex-col items-center gap-3 md:flex-row",children:[t.jsx(N,{title:"Month",children:t.jsx(L,{className:"w-full md:!w-fit",placeholder:"Select a month",options:_,optionLabel:"label",optionValue:"value",value:n,filter:!0,onChange:e=>{d(e.value)}})}),t.jsx(N,{title:"Year",children:t.jsx(V,{name:"year",className:"w-full md:!min-w-fit",readOnlyInput:!0,view:"year",dateFormat:"yy",placeholder:"Select a year",value:c,onChange:e=>a(e.value)})}),t.jsx(N,{title:"Employees",children:t.jsx(L,{className:"w-full md:!w-fit",placeholder:"Select an employee",options:m,optionLabel:e=>`${e==null?void 0:e.employee_name} [${e==null?void 0:e.employee_generated_id}]`,optionValue:"employee_generated_id",value:b,filter:!0,onChange:e=>{j(e.value)}})}),t.jsx(N,{title:"Status",children:t.jsx(L,{className:"w-full md:!w-fit",placeholder:"Select a status",options:E,optionLabel:"label",optionValue:"value",value:w,onChange:e=>{g(e.value)}})}),t.jsxs("div",{className:"flex gap-3 self-end",children:[t.jsx(S,{icon:"pi pi-times",severity:"danger",onClick:()=>{x(""),j(""),a(""),d(""),g(""),l.current&&l.current.refreshListData()}}),t.jsx(S,{icon:"pi pi-search",onClick:()=>{l.current&&l.current.refreshListData()}})]})]}),t.jsx(S,{raised:!0,label:"Upload Letter",icon:t.jsx("img",{src:B}),onClick:()=>r(!0)})]}),t.jsx(T,{dataHandler:i,id:"letters",headers:M,ref:l})]}),t.jsx(ee,{visible:D,onHide:()=>r(!1),tableRef:l})]})};export{ye as default};
