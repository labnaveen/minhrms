import{v as z,ck as ee,r as l,$ as O,cl as T,j as o,f as c,af as oe}from"./index-3ec7abe5.js";import{D as p,C as ae}from"./dropdown.esm-1ad10373.js";import{T as ie}from"./index-b2a6305f.js";import{E as te}from"./edit-c01b3e15.js";import{P as le}from"./plus-b36a0702.js";import{T as se}from"./trash-4a28e917.js";import{C as F}from"./index-3d6f48ca.js";import{u as re,M as ne}from"./validationSchemas-9cdf4188.js";import{I as P}from"./inputtext.esm-e49a03d7.js";import{B as de}from"./index-36dd5a0c.js";import{L as d}from"./index-37ade0e2.js";import{a1 as ce,a2 as pe,a3 as _e,a4 as fe,a5 as ue,a6 as he,a7 as we,a8 as me,a9 as ye,aa as xe,ab as ve,ac as ge}from"./api-f3ada6c1.js";import{M as ke}from"./multiselect.esm-15dd71d0.js";import{u as R}from"./useDispatch-1aeda00f.js";import"./index.esm-9e3aa09b.js";import"./paginator.esm-634e02d4.js";const je=({visible:n,onHide:_,tableRef:x})=>{const S=R(),f=z(ee),[i,v]=l.useState(null),[w,y]=l.useState({}),g=3,[u,s]=l.useState(1),[L,N]=l.useState([]),[b,W]=l.useState([]),[q,B]=l.useState([]),[K,H]=l.useState([]),[I,U]=l.useState([]),[C,$]=l.useState([]),[m,D]=l.useState([]),[h,E]=l.useState([]),Q=async a=>{var r;const t=await _e(a);if(t.data.status===200){v(t.data.data);const k={};(r=t.data.data)==null||r.LeaveTypePolicies.map(j=>{k[j.leave_type.id]=j.id}),y(k)}else v(null)},G=async()=>{const a=await fe(),t=await ue(),r=await he(),k=await we(),j=await me(),M=await ye(),A=await xe();N(a.status===200?a.data.data:[]),W(t.status===200?t.data.data:[]),B(r.status===200?r.data.data:[]),H(k.status===200?k.data.data:[]),U(j.status===200?j.data.data:[]),$(M.status===200?M.data.data:[]),D(A.status===200?A.data.data:[])},J=()=>{s(a=>a+1)},X=()=>{s(a=>a-1)},e=re({initialValues:{policy_name:(i==null?void 0:i.policy_name)||"",policy_description:(i==null?void 0:i.policy_description)||"",attendance_policy_id:(i==null?void 0:i.attendance_policy_id)||"",shift_policy_id:(i==null?void 0:i.shift_policy_id)||"",base_leave_configuration_id:(i==null?void 0:i.base_leave_configuration_id)||"",weekly_off_policy_id:(i==null?void 0:i.weekly_off_policy_id)||"",holiday_calendar_id:(i==null?void 0:i.holiday_calendar_id)||"",attendance_workflow_id:(i==null?void 0:i.attendance_workflow)||"",leave_workflow_id:(i==null?void 0:i.leave_workflow)||"",expense_workflow_id:(i==null?void 0:i.expense_workflow)||"",profile_change_workflow_id:(i==null?void 0:i.profile_change_workflow)||"",leave_type_policies:[]},validationSchema:ne,onSubmit:async a=>{let t;f?t=await pe(f,a):t=await ce(a),(t.status===201||t.status===200)&&(V(),O.success(t.message),x.current.refreshListData())},enableReinitialize:!0}),Y=[{label:"Previous",onClick:X,variant:"secondary",className:"min-w-[90px]",visible:u>1},{label:"Next",onClick:J,className:"min-w-[90px]",visible:u<g},{label:f?"Update":"Add",onClick:e.handleSubmit,className:"min-w-[90px]",visible:u===g,loading:e.isSubmitting}],Z=(a,t)=>{const r={...w};r[a]=t,y(r)},V=()=>{s(1),S(T("")),v(null),y({}),e.resetForm(),_(!1)};return l.useEffect(()=>{n&&G()},[n]),l.useEffect(()=>{n&&f&&Q(f)},[n,f]),l.useEffect(()=>{if(n)if((h==null?void 0:h.length)>0){const a=Object.fromEntries(Object.entries(w).filter(([t])=>h.some(r=>r.id.toString()===t)));y(a)}else y({})},[n,h]),l.useEffect(()=>{n&&e.setFieldValue("leave_type_policies",Object.values(w).filter(a=>a!==void 0))},[n,w]),l.useEffect(()=>{var a;if(n&&((a=Object.keys(i||{}))==null?void 0:a.length)>0&&(m==null?void 0:m.length)>0){const t=[];i==null||i.LeaveTypePolicies.map(r=>{t.push(r.leave_type.id)}),E(m.filter(r=>t.includes(r.id)))}},[n,i,m]),o.jsx(de,{header:`${f?"Update":"Add"} Master Policy`,visible:n,onHide:V,progressValue:u/g,formikInstance:e,actions:Y,children:o.jsxs("div",{className:"m-auto grid w-full gap-3 md:grid-cols-2",children:[u===1&&o.jsxs(o.Fragment,{children:[o.jsx(d,{htmlFor:"policy_name",required:!0,title:"Policy Name",showError:e.errors.policy_name&&e.touched.policy_name,errorMessages:e.errors.policy_name,children:o.jsx(P,{name:"policy_name",value:e.values.policy_name,className:c("w-full",{"p-invalid text-red-500":e.errors.policy_name&&e.touched.policy_name}),onChange:a=>e.setFieldValue("policy_name",a.target.value)})}),o.jsx(d,{htmlFor:"policy_description",required:!0,title:"Description",showError:e.errors.policy_description&&e.touched.policy_description,errorMessages:e.errors.policy_description,children:o.jsx(P,{name:"policy_description",value:e.values.policy_description,className:c("w-full",{"p-invalid text-red-500":e.errors.policy_description&&e.touched.policy_description}),onChange:a=>e.setFieldValue("policy_description",a.target.value)})}),o.jsx("h6",{className:"col-span-2 text-lg font-thin",children:"Policies"}),o.jsx(d,{title:"Attendance",required:!0,showError:e.errors.attendance_policy_id&&e.touched.attendance_policy_id,errorMessages:e.errors.attendance_policy_id,children:o.jsx(p,{id:"attendance_policy_id",dataKey:"id",placeholder:"Select Attendance Policy",options:L,optionLabel:"name",optionValue:"id",value:e.values.attendance_policy_id,className:c("w-full",{"p-invalid text-red-500":e.errors.attendance_policy_id&&e.touched.attendance_policy_id}),onChange:a=>e.setFieldValue("attendance_policy_id",a.value)})}),o.jsx(d,{title:"Shift",required:!0,showError:e.errors.shift_policy_id&&e.touched.shift_policy_id,errorMessages:e.errors.shift_policy_id,children:o.jsx(p,{id:"shift_policy_id",dataKey:"id",placeholder:"Select Shift Policy",options:b,optionLabel:"shift_name",optionValue:"id",value:e.values.shift_policy_id,className:c("w-full",{"p-invalid text-red-500":e.errors.shift_policy_id&&e.touched.shift_policy_id}),onChange:a=>e.setFieldValue("shift_policy_id",a.value)})}),o.jsx(d,{title:"Base Leave Configuration",required:!0,showError:e.errors.base_leave_configuration_id&&e.touched.base_leave_configuration_id,errorMessages:e.errors.base_leave_configuration_id,children:o.jsx(p,{id:"base_leave_configuration_id",dataKey:"id",placeholder:"Select Leave Policy",options:q,optionLabel:"policy_name",optionValue:"id",value:e.values.base_leave_configuration_id,className:c("w-full",{"p-invalid text-red-500":e.errors.base_leave_configuration_id&&e.touched.base_leave_configuration_id}),onChange:a=>e.setFieldValue("base_leave_configuration_id",a.value)})}),o.jsx(d,{title:"Weekly-Off",required:!0,showError:e.errors.weekly_off_policy_id&&e.touched.weekly_off_policy_id,errorMessages:e.errors.weekly_off_policy_id,children:o.jsx(p,{id:"weekly_off_policy_id",dataKey:"id",placeholder:"Select Weekly-Off Policy",options:K,optionLabel:"name",optionValue:"id",value:e.values.weekly_off_policy_id,className:c("w-full",{"p-invalid text-red-500":e.errors.weekly_off_policy_id&&e.touched.weekly_off_policy_id}),onChange:a=>e.setFieldValue("weekly_off_policy_id",a.value)})}),o.jsx(d,{title:"Holiday Calendar",required:!0,showError:e.errors.holiday_calendar_id&&e.touched.holiday_calendar_id,errorMessages:e.errors.holiday_calendar_id,children:o.jsx(p,{id:"holiday_calendar_id",dataKey:"id",placeholder:"Select Holiday Calendar",options:I,optionLabel:"name",optionValue:"id",value:e.values.holiday_calendar_id,className:c("w-full",{"p-invalid text-red-500":e.errors.holiday_calendar_id&&e.touched.holiday_calendar_id}),onChange:a=>e.setFieldValue("holiday_calendar_id",a.value)})})]}),u===2&&o.jsxs(o.Fragment,{children:[o.jsx("h6",{className:"col-span-2 text-lg font-thin",children:"Approval Workflows"}),o.jsx(d,{title:"Attendance Workflow",required:!0,showError:e.errors.attendance_workflow_id&&e.touched.attendance_workflow_id,errorMessages:e.errors.attendance_workflow_id,children:o.jsx(p,{id:"attendance_workflow_id",dataKey:"id",placeholder:"Select Workflow",options:C,optionLabel:"name",optionValue:"id",value:e.values.attendance_workflow_id,className:c("w-full",{"p-invalid text-red-500":e.errors.attendance_workflow_id&&e.touched.attendance_workflow_id}),onChange:a=>e.setFieldValue("attendance_workflow_id",a.value)})}),o.jsx(d,{title:"Leave Workflow",required:!0,showError:e.errors.leave_workflow_id&&e.touched.leave_workflow_id,errorMessages:e.errors.leave_workflow_id,children:o.jsx(p,{id:"leave_workflow_id",dataKey:"id",placeholder:"Select Workflow",options:C,optionLabel:"name",optionValue:"id",value:e.values.leave_workflow_id,className:c("w-full",{"p-invalid text-red-500":e.errors.leave_workflow_id&&e.touched.leave_workflow_id}),onChange:a=>e.setFieldValue("leave_workflow_id",a.value)})}),o.jsx(d,{title:"Profile Change Workflow",required:!0,showError:e.errors.profile_change_workflow_id&&e.touched.profile_change_workflow_id,errorMessages:e.errors.profile_change_workflow_id,children:o.jsx(p,{id:"profile_change_workflow",dataKey:"id",placeholder:"Select Workflow",options:C,optionLabel:"name",optionValue:"id",value:e.values.profile_change_workflow_id,className:c("w-full",{"p-invalid text-red-500":e.errors.profile_change_workflow_id&&e.touched.profile_change_workflow_id}),onChange:a=>e.setFieldValue("profile_change_workflow_id",a.value)})}),o.jsx(d,{title:"Expense Workflow",required:!0,showError:e.errors.expense_workflow_id&&e.touched.expense_workflow_id,errorMessages:e.errors.expense_workflow_id,children:o.jsx(p,{id:"expense_workflow_id",dataKey:"id",placeholder:"Select Workflow",options:C,optionLabel:"name",optionValue:"id",value:e.values.expense_workflow_id,className:c("w-full",{"p-invalid text-red-500":e.errors.expense_workflow_id&&e.touched.expense_workflow_id}),onChange:a=>e.setFieldValue("expense_workflow_id",a.value)})})]}),u===3&&o.jsxs(o.Fragment,{children:[o.jsx(d,{title:"Leave Types",className:"md:col-span-2",children:o.jsx(ke,{dataKey:"id",name:"leave_types",options:m,filter:!0,resetFilterOnHide:!0,showClear:!0,display:"chip",optionLabel:"leave_type_name",placeholder:"Select Leave Types",value:h,onChange:a=>E(a.value),pt:{label:{className:"flex !gap-1 flex-wrap mr-3"},token:{className:"w-max max-h-[2rem] !rounded-[0.25rem] !bg-[#37B3E0] !text-white py-1 px-2 text-sm m-0"}}})}),h.length>0&&o.jsx("h6",{className:"col-span-2 text-lg font-thin",children:"Leave Type Policies"}),h.length>0&&h.map(a=>o.jsx(d,{title:a.leave_type_name,children:o.jsx(p,{id:a.leave_type_name,dataKey:"id",placeholder:"Select Policy",options:a.leave_type_policies,optionLabel:"leave_policy_name",optionValue:"id",value:w[a.id],onChange:t=>Z(a.id,t.value)})},a.id)),m.length<1&&o.jsx("p",{className:"col-span-2 text-center text-lg",children:"No leave types found!"})]})]})})},Be=()=>{const n=R(),_=l.useRef(null),[x,S]=l.useState(""),[f,i]=l.useState(!1),v=async s=>await ve({filterBy:"search_term",filterValue:x,page:s.page+1,records:s.rows,sortBy:s.sortField?s.sortField:"",sortOrder:s.sortField?s.sortOrder===-1?"DESC":"ASC":""}),w=s=>{const L=async N=>{const b=await ge(N);b.status===200&&(O.success(b.message),_.current.refreshListData())};return oe({draggable:!1,resizable:!1,message:"Do you want to delete this record?",header:"Delete Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>L(s.id),reject:()=>{}})},g=[{field:"policy_name",header:"Master Policy Name",sortable:!0},{field:"policy_description",header:"Description"},{field:"actions",align:"center",alignHeader:"center",className:"cursor-default",header:"Actions",body:s=>o.jsxs("div",{className:"flex w-full items-center justify-center gap-3",children:[o.jsx("img",{className:"cursor-pointer",width:25,height:25,src:te,onClick:()=>{n(T(s.id)),i(!0)}}),o.jsx("img",{className:"cursor-pointer",width:25,height:25,src:se,onClick:()=>w(s)})]})}],u=()=>{i(!0)};return o.jsxs("div",{className:"flex w-full flex-col",children:[o.jsx("div",{className:"text-bold flex w-full px-2 pb-4 text-xl text-gray-600",children:"Master Policies"}),o.jsxs(ae,{className:"flex w-full flex-col",children:[o.jsxs("div",{className:"my-2 flex flex-col-reverse justify-between gap-3 p-3 md:flex-row",children:[o.jsxs("div",{className:"flex flex-col items-center gap-3 md:flex-row",children:[o.jsx(P,{placeholder:"Search policy name",value:x,onChange:s=>S(s.target.value)}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(F,{icon:"pi pi-times",severity:"danger",onClick:()=>{S(""),_.current&&_.current.refreshListData()}}),o.jsx(F,{icon:"pi pi-search",disabled:!x,onClick:()=>{_.current&&_.current.refreshListData()}})]})]}),o.jsx(F,{raised:!0,label:"Add Master Policy",icon:o.jsx("img",{src:le}),onClick:u})]}),o.jsx(ie,{dataHandler:v,id:"master_policies",headers:g,ref:_}),o.jsx(je,{visible:f,onHide:()=>i(!1),tableRef:_})]})]})};export{Be as default};
