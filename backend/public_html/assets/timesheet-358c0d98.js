import{r as n,j as s,G as i,ai as F,af as A,aj as S,$ as C}from"./index-3ec7abe5.js";import{C as w}from"./index-3d6f48ca.js";import{C as O}from"./index-7054a830.js";import{P as W}from"./index-36dd5a0c.js";const T=()=>{const[u,x]=n.useState(!1),[e,f]=n.useState(null),[c,a]=n.useState(null),[_,P]=n.useState("00 hr 00 min"),[g,H]=n.useState(null),[h,k]=n.useState(null),[o,E]=n.useState(null),j=async()=>{var l,r,d,Y;const t=await F();t.status===200?(a(M((r=(l=t==null?void 0:t.data)==null?void 0:l.data)==null?void 0:r.punch_in_time,(Y=(d=t==null?void 0:t.data)==null?void 0:d.data)==null?void 0:Y.last_punch_out)),f(t.data.data)):(a(null),f(null))},m=(t,l)=>{if(!t||!l)return!1;const r=i(t,"YYYY-MM-DD HH:mm:ss");return i(l.trim(),"YYYY-MM-DD HH:mm:ss").isSameOrAfter(r)},M=(t,l)=>{if(!t)return null;const r=i(t).set({seconds:0,milliseconds:0}).format("YYYY-MM-DD HH:mm:ss");console.log("Punch in moment: ",r);const d=m(t,l)?i(l).local().set({seconds:0,milliseconds:0}):i().set({seconds:0,milliseconds:0});return console.log(">>>>}}}}}}}}}}}}",d.local().format("YYYY-MM-DD HH:mm:ss")),i.duration(d.diff(r))},b=t=>{if(!t)return"00 hr 00 min";console.log("Time Data: ",t);const l=Math.floor(t.asMinutes()/60),r=Math.floor(t.asMinutes()%60);return`${l} ${l>1?"hrs":"hr"} ${r} ${r>1?"mins":"min"}`},y=()=>s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsx("p",{className:"text-sm",children:"Total hours worked:"}),s.jsxs("div",{className:"relative w-full",children:[s.jsx(W,{showValue:!1,className:"w-full",color:"#37B3E0",value:c?c.asMinutes()/((e==null?void 0:e.total_working_hours)*60).toFixed(2)*100:0}),s.jsx("p",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 transform text-xs",children:_})]})]}),N=()=>{const t=async()=>{x(!0);let l={};g&&h&&(l.latitude=g,l.longitude=h);const r=await S(l);r.status===200&&C.success(r.message),j(),x(!1)};return e!=null&&e.punch_in_time?A({draggable:!1,resizable:!1,message:s.jsx(y,{}),header:"Punch Out",icon:"pi pi-info-circle",acceptClassName:"p-button-danger text-sm p-2",rejectClassName:"p-button-link mr-2 text-sm p-2",acceptLabel:"Punch Out",accept:()=>t(),rejectLabel:"Cancel",reject:()=>{}}):t()},v=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t):console.log("Location not allowed");function t(l){l.coords.latitude&&l.coords.longitude&&(H(l.coords.latitude),k(l.coords.longitude))}};return n.useEffect(()=>{j(),v()},[]),n.useEffect(()=>{let t;return e!=null&&e.punch_in_time&&!m(e==null?void 0:e.punch_in_time,e==null?void 0:e.last_punch_out)&&(t=setInterval(()=>{e!=null&&e.punch_in_time&&a(M(e==null?void 0:e.punch_in_time,e==null?void 0:e.last_punch_out))},6e4)),()=>{t&&clearInterval(t)}},[e]),n.useEffect(()=>{c&&P(b(c))},[c]),s.jsxs(s.Fragment,{children:[s.jsx("p",{name:"card-heading",className:"w-full text-[#37B3E0]",children:"Timesheet"}),(e==null?void 0:e.total_working_hours)&&s.jsxs("div",{className:"flex w-full flex-col rounded bg-[#FAFBFD] p-3",children:[(e==null?void 0:e.punch_in_time)&&!m(e==null?void 0:e.punch_in_time,e==null?void 0:e.last_punch_out)&&s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-center text-lg",children:"Punched In At"}),s.jsx("p",{className:"text-center text-xs",children:i.utc(e.punch_in_time,"YYYY-MM-DD HH:mm:ss").local().format("ddd, DD MMMM yyyy hh:mm A")})]}),(!(e!=null&&e.punch_in_time)&&(e==null?void 0:e.last_punch_out)||m(e==null?void 0:e.punch_in_time,e==null?void 0:e.last_punch_out))&&s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-center text-lg",children:"Last Punch Out At"}),s.jsx("p",{className:"text-center text-xs",children:i(e.last_punch_out,"YYYY-MM-DD HH:mm:ss").format("ddd, DD MMMM yyyy hh:mm A")})]}),!(e!=null&&e.punch_in_time)&&!(e!=null&&e.last_punch_out)&&s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-center text-lg",children:"Last Punch Out At"}),s.jsx("p",{className:"text-center text-xs",children:"Not Found!"})]}),o&&s.jsx("div",{children:s.jsxs("p",{className:"text-center text-xs",children:[o==null?void 0:o.suburb,",",o==null?void 0:o.town,",",o==null?void 0:o.state_district,",",o==null?void 0:o.city,",",o==null?void 0:o.country]})})]}),!(e!=null&&e.total_working_hours)&&s.jsxs("div",{className:"flex w-full flex-col rounded bg-[#FAFBFD] p-3",children:[s.jsx("p",{className:"text-center text-lg",children:"Uh-oh! Shift policy not found!"}),s.jsx("p",{className:"text-center text-xs",children:"Please contact your HR to have a shift policy assigned."})]}),s.jsxs("div",{className:"flex w-full flex-col items-center justify-center gap-3 p-3",children:[s.jsxs(O,{maxWidth:"150px",minValue:0,maxValue:((e==null?void 0:e.total_working_hours)*60).toFixed(2),value:c?c.asMinutes():0,children:[s.jsx("p",{className:"text-center text-sm font-bold",children:"Worked Hours"}),s.jsx("p",{className:"text-center text-sm font-normal",children:_})]}),(!(e!=null&&e.punch_in_time)||!(e!=null&&e.punch_in_time)&&!(e!=null&&e.last_punch_out))&&s.jsx(w,{disabled:u||!(e!=null&&e.total_working_hours),raised:!0,label:"Punch In",className:"mt-3 px-5",onClick:N}),(e==null?void 0:e.punch_in_time)&&s.jsx(w,{disabled:u||!(e!=null&&e.total_working_hours),raised:!0,label:"Punch Out",className:"p-button-danger mt-3 px-5",onClick:N})]})]})};export{T};
