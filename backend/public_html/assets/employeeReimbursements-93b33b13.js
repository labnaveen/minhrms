import{r as l,v as se,aH as re,G as _,$ as g,aI as W,aJ as K,j as t,f as x,aK as oe,aL as Z,aM as le,aN as ne,aO as ie,aP as de,aQ as ce,af as ue,aR as me}from"./index-3ec7abe5.js";import{D as Q,C as X}from"./dropdown.esm-1ad10373.js";import{T as pe}from"./index-b2a6305f.js";import{A as fe,P as he,R as _e}from"./rejected_expenses-cb75fdf8.js";import{E as xe}from"./edit-c01b3e15.js";import{T as ge}from"./trash-4a28e917.js";import{P as ye}from"./chart.esm-d108b7db.js";import{T as je}from"./index-c74eb1f3.js";import{C as be}from"./index-3d6f48ca.js";import{u as ve,b as Ee}from"./validationSchemas-9cdf4188.js";import{I as E}from"./inputtext.esm-e49a03d7.js";import{B as we}from"./index-36dd5a0c.js";import{L as c}from"./index-37ade0e2.js";import{C as $}from"./calendar.esm-f987a87a.js";import{I as Ne}from"./inputswitch.esm-65362ee3.js";import{I as Se}from"./inputtextarea.esm-51dfddb5.js";import{I as Fe,a as Ce}from"./index.esm-6710b6c8.js";import{u as ee}from"./useDispatch-1aeda00f.js";import{I as Me}from"./index.esm-66734f9f.js";import"./index.esm-9e3aa09b.js";import"./paginator.esm-634e02d4.js";import"./index.esm-be3d6ae7.js";import"./iconBase-2780a5a8.js";const Ye=({visible:D,onHide:v,tableRef:Y})=>{var J,z;const q=ee(),O=l.useRef(null),p=se(re),[w]=l.useState(_().format("YYYY-MM-DD")),[i,k]=l.useState(null),[N,A]=l.useState(!1),[u,S]=l.useState(null),[n,b]=l.useState(null),[H,L]=l.useState(null),[I,m]=l.useState(!1),[f,T]=l.useState(null),[s,R]=l.useState(null),[P,F]=l.useState(!1),B=async()=>{const a=await oe();k(a.status===200?a.data.data:null)};console.log(p);const C=()=>{R(null),q(Z(null)),e.resetForm(),A(""),S(""),v(!1),b(null),L(null)},V=async()=>{const a=new FormData;a.append("file",n);const d=await le(a);return d.status==200?d.data.data.id:null},e=ve({initialValues:{purpose_id:(s==null?void 0:s.purpose_id)||"",purpose_text:(s==null?void 0:s.purpose_text)||"",category_id:(s==null?void 0:s.category_id)||"",merchant_name:(s==null?void 0:s.merchant_name)||"",amount:(s==null?void 0:s.amount)||0,transaction_date:(s==null?void 0:s.transaction_date)||w,total_distance:(s==null?void 0:s.total_distance)||0,stay_from_date:(s==null?void 0:s.stay_from_date)||"",stay_to_date:(s==null?void 0:s.stay_to_date)||"",from_location:(s==null?void 0:s.from_location)||"",to_location:(s==null?void 0:s.to_location)||"",billing_type_id:(s==null?void 0:s.billing_type_id)||"",bill_no:(s==null?void 0:s.bill_no)||"",note:(s==null?void 0:s.note)||"",supporting_document_url:(s==null?void 0:s.supporting_document_url)||null,document_id:(s==null?void 0:s.document_id)||null,status_id:(s==null?void 0:s.status_id)||2,bill_available:(s==null?void 0:s.bill_available)||!1,billing_status:!0},validationSchema:Ee(N,u),onSubmit:async a=>{let d;if(n){if((n==null?void 0:n.name)!==(f==null?void 0:f.name))if(n.size<=5e6)if(r.includes(n.name.split(".")[1])){const h=await V();a.document_id=h}else return g.error("Please select a valid file type. Allowed types are pdf, jpg, png");else return g.error("Please upload a file less than 5 mb");p?(a.status_id=2,d=await K(p,a)):d=await W(a),(d.status===200||d.status===200)&&(C(),g.success("Expense submitted succesfully!"),Y.current.refreshListData())}else F(!0)},enableReinitialize:!0}),o=()=>{b(null),T(null)},r=["pdf","jpg","jpeg","png"],y=async a=>{m(!0),await e.validateForm();const d={};if(Object.keys(a).forEach(h=>{d[h]=!0}),e.setTouched(d),!n)return F(!0),m(!1);if(e.isValid&&n)if(p){if((n==null?void 0:n.name)!==(f==null?void 0:f.name))if(n.size<=5e6)if(r.includes(n.name.split(".")[1])){const M=await V();a.document_id=M}else return g.error("Please select a valid file type. Allowed types are pdf, jpg, png"),m(!1);else return g.error("Please upload a file less than 5 mb"),m(!1);const h=await K(p,a);h.status==200&&(g.success(h.message),Y.current.refreshListData(),m(!1),C()),m(!1)}else{if(e.values.status_id=1,n.size<=5e6)if(r.includes(n.name.split(".")[1])){const M=await V();a.document_id=M}else return g.error("Please select a valid file type. Allowed types are pdf, jpg, png"),m(!1);else return g.error("Please upload a file less than 5 mb"),m(!1);const h=await W(a);h.status==200&&(g.success(h.message),Y.current.refreshListData(),m(!1),C())}m(!1)};l.useEffect(()=>{n||e.setFieldValue("document_id",null)},[n]);const j=[{label:"Submit",onClick:e.handleSubmit,className:"min-w-[90px]",loading:e.isSubmitting},{label:"Save as Draft",onClick:()=>y(e.values),className:"min-w-[90px]",loading:I}],U=async()=>{var d,h,M,G;const a=await ne(p);if(a.status==200){R(a.data.data);const te=(d=i==null?void 0:i.categoriesList)==null?void 0:d.find(ae=>ae.id===a.data.data.category_id);S(te),T(a.data.data.document),b(a.data.data.document),a.data.data.document&&F(!1),L((G=(M=(h=a==null?void 0:a.data)==null?void 0:h.data)==null?void 0:M.document)==null?void 0:G.id)}};return l.useEffect(()=>{p&&U()},[p,D]),l.useEffect(()=>{!p&&(u==null?void 0:u.id)===1&&(e.setFieldValue("stay_from_date",w),e.setFieldValue("stay_to_date",w),console.log("Goes here"))},[p,u]),l.useEffect(()=>{B()},[]),t.jsx(we,{header:"Add Edit Expenses",visible:D,onHide:C,actions:j,children:t.jsxs("div",{className:"m-auto grid w-full gap-3 md:grid-cols-2",children:[t.jsx(c,{required:!0,htmlFor:"purpose_id",title:"Purpose",showError:e.errors.purpose_id&&e.touched.purpose_id,errorMessages:e.errors.purpose_id,children:t.jsx(Q,{inputId:"purpose_id",placeholder:"Select purpose",options:(i==null?void 0:i.purposesList)||[],optionLabel:"name",optionValue:"id",value:e.values.purpose_id,onChange:a=>{e.setFieldValue("purpose_id",a.value),A(i==null?void 0:i.purposesList.filter(d=>d.id===a.value)[0])}})}),(N==null?void 0:N.showCommentBox)&&t.jsx(c,{required:!0,title:"Remarks",htmlFor:"purpose_text",showError:e.errors.purpose_text&&e.touched.purpose_text,errorMessages:e.errors.purpose_text,children:t.jsx(E,{name:"purpose_text",value:e.values.purpose_text,className:x("w-full",{"p-invalid text-red-500":e.errors.purpose_text&&e.touched.purpose_text}),onChange:a=>e.setFieldValue("purpose_text",a.target.value)})}),t.jsx(c,{required:!0,htmlFor:"category_id",title:"Expense Category",showError:e.errors.category_id&&e.touched.category_id,errorMessages:e.errors.category_id,children:t.jsx(Q,{inputId:"category_id",placeholder:"Select category",options:(i==null?void 0:i.categoriesList)||[],optionLabel:"category_name",optionValue:"id",value:e.values.category_id,onChange:a=>{e.setFieldValue("category_id",a.value),S(i==null?void 0:i.categoriesList.filter(d=>d.id===a.value)[0])}})}),e.values.category_id&&t.jsxs(t.Fragment,{children:[t.jsx(c,{required:!0,title:"Service Provider",htmlFor:"merchant_name",showError:e.errors.merchant_name&&e.touched.merchant_name,errorMessages:e.errors.merchant_name,children:t.jsx(E,{name:"merchant_name",value:e.values.merchant_name,className:x("w-full",{"p-invalid text-red-500":e.errors.merchant_name&&e.touched.merchant_name}),onChange:a=>e.setFieldValue("merchant_name",a.target.value)})}),t.jsx(c,{required:!0,title:"Amount",htmlFor:"amount",showError:e.errors.amount&&e.touched.amount,errorMessages:e.errors.amount,children:t.jsx(E,{name:"amount",value:e.values.amount,className:x("w-full",{"p-invalid text-red-500":e.errors.amount&&e.touched.amount}),onChange:a=>e.setFieldValue("amount",a.target.value)})}),t.jsx(c,{htmlFor:"transaction_date",required:!0,title:"Transaction Date",showError:e.errors.transaction_date&&e.touched.transaction_date,errorMessages:e.errors.transaction_date,children:t.jsx($,{dateFormat:"dd-mm-yy",readOnlyInput:!0,maxDate:_().toDate(),value:_(e.values.transaction_date,"YYYY-MM-DD").toDate(),className:x("w-full",{"p-invalid text-red-500":e.errors.transaction_date&&e.touched.transaction_date}),onChange:a=>e.setFieldValue("transaction_date",_(a.value).format("YYYY-MM-DD"))})}),((J=u==null?void 0:u.expencesCategoriesForm)==null?void 0:J.category_form_name)==="Travel Form"&&t.jsxs(t.Fragment,{children:[t.jsx(c,{required:!0,title:"Total Kms",htmlFor:"total_distance",showError:e.errors.total_distance&&e.touched.total_distance,errorMessages:e.errors.total_distance,children:t.jsx(E,{name:"total_distance",value:e.values.total_distance,className:x("w-full",{"p-invalid text-red-500":e.errors.total_distance&&e.touched.total_distance}),onChange:a=>e.setFieldValue("total_distance",a.target.value)})}),t.jsxs("div",{className:"m-0 grid gap-3 md:col-span-2 md:grid-cols-2",children:[t.jsx(c,{required:!0,title:"From Location",htmlFor:"from_location",showError:e.errors.from_location&&e.touched.from_location,errorMessages:e.errors.from_location,children:t.jsx(E,{name:"from_location",value:e.values.from_location,className:x("w-full",{"p-invalid text-red-500":e.errors.from_location&&e.touched.from_location}),onChange:a=>e.setFieldValue("from_location",a.target.value)})}),t.jsx(c,{required:!0,title:"To Location",htmlFor:"to_location",showError:e.errors.to_location&&e.touched.to_location,errorMessages:e.errors.to_location,children:t.jsx(E,{name:"to_location",value:e.values.to_location,className:x("w-full",{"p-invalid text-red-500":e.errors.to_location&&e.touched.to_location}),onChange:a=>e.setFieldValue("to_location",a.target.value)})})]})]}),((z=u==null?void 0:u.expencesCategoriesForm)==null?void 0:z.category_form_name)==="Stay Form"&&t.jsxs("div",{className:"m-0 grid gap-3 md:col-span-2 md:grid-cols-2",children:[t.jsx(c,{htmlFor:"stay_from_date",required:!0,title:"Start Date",showError:e.errors.stay_from_date&&e.touched.stay_from_date,errorMessages:e.errors.stay_from_date,children:t.jsx($,{dateFormat:"dd-mm-yy",readOnlyInput:!0,value:_(e.values.stay_from_date,"YYYY-MM-DD").toDate(),className:x("w-full",{"p-invalid text-red-500":e.errors.stay_from_date&&e.touched.stay_from_date}),onChange:a=>{e.setFieldValue("stay_from_date",_(a.value).format("YYYY-MM-DD")),e.setFieldValue("stay_to_date",_(a.value).format("YYYY-MM-DD"))}})}),t.jsx(c,{htmlFor:"stay_to_date",required:!0,title:"End Date",showError:e.errors.stay_to_date&&e.touched.stay_to_date,errorMessages:e.errors.stay_to_date,children:t.jsx($,{dateFormat:"dd-mm-yy",readOnlyInput:!0,minDate:_(e.values.stay_from_date,"YYYY-MM-DD").toDate(),value:_(e.values.stay_to_date,"YYYY-MM-DD").toDate(),className:x("w-full",{"p-invalid text-red-500":e.errors.stay_to_date&&e.touched.stay_to_date}),onChange:a=>e.setFieldValue("stay_to_date",_(a.value).format("YYYY-MM-DD"))})})]}),t.jsxs("div",{className:"m-0 grid gap-3 md:col-span-2 md:grid-cols-2",children:[t.jsx(c,{title:"Bill Available?",children:t.jsx(Ne,{name:"billing_status",checked:e.values.bill_available,onChange:a=>{e.setFieldValue("bill_available",a.value),a.value||e.setFieldValue("bill_no","")}})}),e.values.bill_available&&t.jsx(c,{required:!0,title:"Bill Number",htmlFor:"bill_no",showError:e.errors.bill_no&&e.touched.bill_no,errorMessages:e.errors.bill_no,children:t.jsx(E,{name:"bill_no",disabled:!e.values.bill_available,value:e.values.bill_no,className:x("w-full",{"p-invalid text-red-500":e.errors.bill_no&&e.touched.bill_no}),onChange:a=>e.setFieldValue("bill_no",a.target.value)})})]}),t.jsx(c,{required:!0,title:"Note",htmlFor:"note",className:"md:col-span-2",showError:e.errors.note&&e.touched.note,errorMessages:e.errors.note,children:t.jsx(Se,{name:"note",rows:3,autoResize:!0,value:e.values.note,className:x("w-full",{"p-invalid text-red-500":e.errors.note&&e.touched.note}),onChange:a=>e.setFieldValue("note",a.target.value)})}),t.jsx(c,{required:!0,title:"Supporting Document",htmlFor:"document",className:"md:col-span-2 cursor-pointer",children:t.jsxs("div",{className:"min-h-max w-full border-2 relative border-dashed border-slate-200 cursor-pointer py-2",children:[t.jsx("input",{type:"file",ref:O,onChange:a=>{b(a.target.files[0]),F(!1)},onClick:a=>{a.target.value=""},className:"opacity-0 absolute w-full h-full cursor-pointer",accept:".pdf, .png, .jpeg, .jpg"}),t.jsxs("div",{className:"flex flex-col justify-center cursor-pointer",children:[t.jsx(Fe,{className:"text-4xl mx-auto self-center "}),t.jsxs("p",{className:"mx-auto self-center mt-3",children:[t.jsx("span",{className:"underline",children:"Click to upload"})," a file"]})]})]})}),P&&t.jsx("p",{className:"p-invalid text-sm text-red-600",children:"Supporting document is required"}),n&&t.jsxs("div",{className:"selected-file flex gap-3",children:[n.name,t.jsx(Ce,{className:"text-red-600 cursor-pointer text-2xl",onClick:o})]})]})]})})},Ae="https://api.minhrms.com/",tt=()=>{const D=ee(),v=l.useRef(null);l.useState(new Date);const[Y,q]=l.useState({}),[O,p]=l.useState({}),[w,i]=l.useState(0),[k,N]=l.useState(0),[A,u]=l.useState(0),[S,n]=l.useState(null),[b,H]=l.useState(0),[L,I]=l.useState(!1),[m,f]=l.useState("3"),[T,s]=l.useState({first:0,rows:10,page:0,categoryId:m}),R=[{id:1,label:"Travel Expenses"},{id:2,label:"Food Expenses"},{id:3,label:"Hotel Expenses"},{id:4,label:"Good & Services Expense"},{id:5,label:"Other Expenses"}],P=async o=>await ie({page:o.page+1,records:o.rows,sortBy:o.sortField?o.sortField:"",sortOrder:o.sortField?o.sortOrder===-1?"DESC":"ASC":"",category_id:m}),F=async()=>{const o=await de();o.status===200&&(u(o.data.data.approvedExpense.total_approved_amount),N(o.data.data.rejectedExpense.total_rejected_amount),i(o.data.data.pendingExpense.total_pending_amount))},B=async()=>{const o=_().year(),r=await ce(o);if(r.status==200){const y=[];r.data.data.map(j=>{y.push(parseInt(j.total_amount))}),console.log(y),n(y)}};l.useEffect(()=>{F(),B()},[]);const C=o=>{const r=async y=>{const j=await me(y);j.status==200&&j.data.success==!0?(g.success(j.message),v.current.refreshListData()):(g.error(j.message),v.current.refreshListData())};return ue({draggable:!1,resizable:!1,message:t.jsx("p",{children:"Do you want to delete this expense draft?"}),header:"Delete Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>r(o.id),reject:()=>{}})},V=o=>{var r;return t.jsx("div",{className:"flex items-center justify-center gap-3",children:t.jsx("a",{href:`${Ae+((r=o==null?void 0:o.document)==null?void 0:r.public_url)}`,target:"_blank",children:t.jsx(Me,{className:"text-2xl cursor-pointer"})})})},e=o=>[{field:"request_date",header:"Applied On",sortable:!0,body:r=>_(r.created_at).format("ddd, MMM DD, YYYY")},{field:"transaction_date",header:"Transaction Date",sortable:!1,body:r=>t.jsx("p",{children:r.transaction_date})},{field:"purpose",header:"Purpose",sortable:!0,body:r=>t.jsx("p",{children:r.expencesPurpuse.name})},{field:"bill_number",header:"Bill No.",body:r=>r.billing_status?t.jsx("p",{children:r.bill_no}):t.jsx("p",{children:"NA"})},...o==0?[{field:"from_location",header:"From",sortable:!1,body:r=>t.jsx("p",{children:r.from_location})},{field:"to_location",header:"To",sortable:!1,body:r=>t.jsx("p",{children:r.to_location})},{field:"total_distance",header:"Total Distance",sortable:!1,body:r=>t.jsxs("p",{children:[r.total_distance," km"]})}]:[],...o==2?[{field:"duration",header:"Duration",sortable:!0,body:r=>t.jsx("p",{children:`${r.stay_from_date} - ${r.stay_to_date}`})}]:[],{field:"merchant_name",header:"Merchant Name",sortable:!0},{field:"amount",sortable:!0,header:"Amount",body:r=>`₹${r.amount}`},{field:"supporting_docs",header:"Supporting Docs",sortable:!1,headerClassName:"w-[50px]",body:r=>r.document?V(r):"---"},{field:"note",sortable:!0,header:"Note",body:r=>r.note||"---"},{field:"comment",sortable:!1,header:"Comment",body:r=>r.comment||"---"},{field:"status",header:"Status",body:r=>t.jsx("div",{className:"py-1 px-1 rounded-full border text-center",style:{background:`${r.expencesApprovalStatus.button_hex_color}`,borderColor:`${r.expencesApprovalStatus.border_hex_color}`},children:r.expencesApprovalStatus.name})},{field:"actions",header:"Actions",alignHeader:"center",body:r=>t.jsxs("div",{className:"flex flex-col gap-3 md:flex-row",children:[r.expencesApprovalStatus.id==1&&t.jsx("img",{className:"cursor-pointer",width:25,height:25,src:xe,onClick:()=>{D(Z(r.id)),I(!0)}}),r.expencesApprovalStatus.id==1&&t.jsx("img",{className:"cursor-pointer",width:25,height:25,src:ge,onClick:()=>C(r)})]})}];return l.useEffect(()=>{const o={labels:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],datasets:[{data:S,backgroundColor:["#37B3E0"],barThickness:25,borderWidth:1}]},r={plugins:{legend:{display:!1}},scales:{x:{grid:{display:!1}},y:{grid:{display:!1},ticks:{callback:(y,j,U)=>`₹${y}`}}},responsive:!0,maintainAspectRatio:!1};q(o),p(r)},[S]),l.useEffect(()=>{P(T)},[b,T]),t.jsxs("div",{className:"flex w-full flex-col gap-3",children:[t.jsxs(X,{className:"flex-col gap-3 p-3",children:[t.jsx("p",{name:"card-heading",className:"my-auto text-[#37B3E0]",children:"Reimbursements Summary"}),t.jsxs("div",{className:"m-0 grid w-full justify-center gap-3 md:grid-cols-8",children:[t.jsxs("div",{className:"flex flex-col gap-3 md:col-span-2",children:[t.jsxs("div",{className:"flex w-full gap-3",children:[t.jsx("img",{className:"h-[50px] w-[50px] self-center",src:fe}),t.jsxs("div",{className:"flex w-full flex-col justify-center",children:[t.jsx("p",{className:"text-right text-sm",children:t.jsxs("span",{children:["₹",t.jsx("span",{children:A||0})]})}),t.jsx("p",{className:"text-right text-xs",children:"Approved Expenses"})]})]}),t.jsxs("div",{className:"flex w-full gap-3",children:[t.jsx("img",{className:"h-[50px] w-[50px] self-center",src:he}),t.jsxs("div",{className:"flex w-full flex-col justify-center",children:[t.jsx("p",{className:"text-right text-sm",children:t.jsxs("span",{children:["₹",t.jsx("span",{children:w||0})]})}),t.jsx("p",{className:"text-right text-xs",children:"Pending Expenses"})]})]}),t.jsxs("div",{className:"flex h-max w-full gap-3",children:[t.jsx("img",{className:"h-[50px] w-[50px] self-center",src:_e}),t.jsxs("div",{className:"flex w-full flex-col justify-center",children:[t.jsx("p",{className:"text-right text-sm",children:t.jsxs("span",{children:["₹",t.jsx("span",{children:k||0})]})}),t.jsx("p",{className:"text-right text-xs",children:"Rejected Expenses"})]})]})]}),t.jsx("div",{className:"relative flex w-full md:col-span-6",children:t.jsx(ye,{className:"w-full",type:"bar",data:Y,options:O})})]})]}),t.jsxs(X,{className:"flex w-full flex-col",children:[t.jsxs("div",{className:"my-2 flex flex-row justify-between p-3",children:[t.jsx("div",{className:"flex items-center",children:"Search Component"}),t.jsx(be,{raised:!0,label:"Add Expense",className:"px-3",onClick:()=>I(!0)})]}),t.jsx(je,{containerClassName:"mb-3",className:"w-full text-sm md:col-span-5",activeIndex:b,onTabChange:o=>{console.log("EVENT",o),H(o.index),o.index==0&&f("3"),o.index==1&&f("2"),o.index==2&&f("1"),o.index==3&&f("4"),o.index==4&&f("5"),v.current.refreshListData()},model:R}),t.jsx(pe,{ref:v,dataHandler:P,id:"regularisation_requests",headers:e(b)})]}),t.jsx(Ye,{visible:L,onHide:()=>I(!1),tableRef:v})]})};export{tt as default};
