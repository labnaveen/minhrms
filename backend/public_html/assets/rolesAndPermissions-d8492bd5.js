import{v as E,bU as P,r as m,$ as w,bV as A,j as s,f as y,B as H,af as q}from"./index-3ec7abe5.js";import{C as R}from"./checkbox.esm-7c1abfc1.js";import{C as O}from"./dropdown.esm-1ad10373.js";import{T as G,D as Q,C as $}from"./index-b2a6305f.js";import{C as j}from"./index-3d6f48ca.js";import{A as D}from"./arrow-back-2554853d.js";import{E as J}from"./edit-c01b3e15.js";import{P as K}from"./plus-b36a0702.js";import{T as W}from"./trash-4a28e917.js";import{O as X,P as Y,Q as Z,R as z,S as ee,T as se,U as ie}from"./api-9d9fddec.js";import{u as te,q as ae}from"./validationSchemas-9cdf4188.js";import{I as N}from"./inputtext.esm-e49a03d7.js";import{B as re,M as le}from"./index-36dd5a0c.js";import{L}from"./index-37ade0e2.js";import{u as _}from"./useDispatch-1aeda00f.js";import"./index.esm-9e3aa09b.js";import"./paginator.esm-634e02d4.js";const ce="/assets/permissions-dc0455c9.svg",oe=({visible:h,onHide:u,tableRef:C})=>{const b=_(),n=E(P),[p,x]=m.useState(),S=async c=>{const o=await Z(c);o.data.status===200?x(o.data.data):x(null)},l=te({initialValues:{name:(p==null?void 0:p.name)||"",description:(p==null?void 0:p.description)||""},validationSchema:ae,onSubmit:async c=>{let o;n?o=await Y(n,c):o=await X(c),(o.status===201||o.status===200)&&(g(),w.success(o.message),C.current.refreshListData())},enableReinitialize:!0}),k=[{label:n?"Update":"Add",onClick:l.handleSubmit,className:"min-w-[90px]",loading:l.isSubmitting}],g=()=>{b(A("")),l.resetForm(),x(null),u(!1)};return m.useEffect(()=>{h&&n&&S(n)},[h,n]),s.jsx(re,{header:`${n?"Update":"Add"} Access Role`,visible:h,onHide:g,actions:k,children:s.jsxs("div",{className:"m-auto grid w-full gap-3",children:[s.jsx(L,{htmlFor:"name",required:!0,title:"Role name",showError:l.errors.name&&l.touched.name,errorMessages:l.errors.name,children:s.jsx(N,{name:"name",value:l.values.name,className:y("w-full",{"p-invalid text-red-500":l.errors.name&&l.touched.name}),onChange:c=>l.setFieldValue("name",c.target.value)})}),s.jsx(L,{htmlFor:"description",required:!0,title:"Description",showError:l.errors.description&&l.touched.description,errorMessages:l.errors.description,children:s.jsx(N,{description:"description",value:l.values.description,className:y("w-full",{"p-invalid text-red-500":l.errors.description&&l.touched.description}),onChange:c=>l.setFieldValue("description",c.target.value)})})]})})},ve=()=>{const h=_(),u=m.useRef(null),C=E(P),[b,n]=m.useState(""),[p,x]=m.useState(!1),[S,l]=m.useState(""),[k,g]=m.useState(!1),[c,o]=m.useState([]),[t,f]=m.useState([]),F=e=>z({filterBy:"search_term",filterValue:b,page:e.page+1,records:e.rows,sortBy:e.sortField||"",sortOrder:e.sortField?e.sortOrder===-1?"DESC":"ASC":""}),B=async()=>{const e=await ee();if(e.data.status===200){const a={};for(const r of e.data.data){const[d,V]=r.name.split(".");a[d]||(a[d]={page_name:d,page_alias:(d.charAt(0).toUpperCase()+d.slice(1)).replaceAll("_"," "),permissions:{}}),a[d].permissions[V]=r.id}const i=Object.values(a);o(i)}else o([])},M=e=>{const a=async i=>{const r=await ie(i);r.status===200&&(w.success(r.message),u.current.refreshListData())};q({draggable:!1,resizable:!1,message:"Do you want to delete this record?",header:"Delete Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>a(e.id),reject:()=>{}})},T=[{field:"role_name",header:"Role Name",sortable:!0,body:e=>e.name},{field:"user_count",header:"Total Employees",sortable:!0,body:e=>(e==null?void 0:e.user_count)||"N/A"},{field:"actions",align:"center",alignHeader:"center",className:"cursor-default",header:"Actions",body:e=>s.jsxs("div",{className:"flex w-full items-center justify-center gap-3",children:[s.jsx("img",{className:"cursor-pointer",width:25,height:25,src:ce,onClick:()=>{const a=e.permissions.map(i=>i.id);h(A(e.id)),l(e.name),f(a),x(!0)}}),e.is_system_generated!=!0&&s.jsx("img",{className:"cursor-pointer",width:25,height:25,src:J,onClick:()=>{h(A(e.id)),g(!0)}}),e.is_system_generated!=!0&&s.jsx("img",{className:"cursor-pointer",width:25,height:25,src:W,onClick:()=>M(e)})]})}],I=[{field:"page_name",header:"Module Name",body:e=>e.page_alias},{field:"all",header:"All",body:e=>s.jsx(R,{checked:Object.values(e.permissions).every(a=>t.includes(a)),onChange:a=>{let i;if(a.checked)i=[...t].concat(Object.values(e.permissions));else{const r=Object.values(e.permissions);i=t.filter(d=>!r.includes(d))}f(i)}})},{field:"list",header:"View",body:e=>s.jsx(R,{checked:t.includes(e.permissions.view),onChange:a=>{let i;if(a.checked)i=[...t,e.permissions.view];else{const r=Object.values(e.permissions);i=t.filter(d=>!r.includes(d))}f(i)}})},{field:"add",header:"Add",body:e=>s.jsx(R,{checked:t.includes(e.permissions.add),disabled:!t.includes(e.permissions.view),onChange:a=>{const i=[...t];if(a.checked)i.push(e.permissions.add);else{const r=i.indexOf(e.permissions.add);r>-1&&i.splice(r,1)}f(i)}})},{field:"edit",header:"Edit",body:e=>s.jsx(R,{checked:t.includes(e.permissions.edit),disabled:!t.includes(e.permissions.view),onChange:a=>{const i=[...t];if(a.checked)i.push(e.permissions.edit);else{const r=i.indexOf(e.permissions.edit);r>-1&&i.splice(r,1)}f(i)}})},{field:"delete",header:"Delete",body:e=>s.jsx(R,{checked:t.includes(e.permissions.delete),disabled:!t.includes(e.permissions.view),onChange:a=>{const i=[...t];if(a.checked)i.push(e.permissions.delete);else{const r=i.indexOf(e.permissions.delete);r>-1&&i.splice(r,1)}f(i)}})}],U=async()=>{if((t==null?void 0:t.length)<1)return;const e=await se(C,{permissions:t});e.status===200&&(w.success(e.message),v())},v=()=>{h(A("")),l(""),f([]),x(!1)};return m.useEffect(()=>{B()},[]),s.jsxs("div",{className:"flex w-full flex-col",children:[!p&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-bold flex w-full px-2 pb-4 text-xl text-gray-600",children:"Access Roles"}),s.jsxs(O,{className:"flex w-full flex-col",children:[s.jsxs("div",{className:"my-2 flex flex-col-reverse justify-between gap-3 p-3 md:flex-row",children:[s.jsxs("div",{className:"flex flex-col items-center gap-3 md:flex-row",children:[s.jsx(N,{placeholder:"Search role name",value:b,onChange:e=>n(e.target.value)}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(j,{icon:"pi pi-times",severity:"danger",onClick:()=>{n(""),u.current&&u.current.refreshListData()}}),s.jsx(j,{icon:"pi pi-search",disabled:!b,onClick:()=>{u.current&&u.current.refreshListData()}})]})]}),s.jsx(j,{raised:!0,label:"Add Access Role",icon:s.jsx("img",{src:K}),onClick:()=>g(!0)})]}),s.jsx(G,{dataHandler:F,id:"holiday_calendar_list",headers:T,ref:u})]})]}),p&&s.jsxs(s.Fragment,{children:[s.jsx(H,{className:"w-max gap-2 border-none px-0 !font-extralight !text-black shadow-none",icon:s.jsx("img",{src:D}),link:!0,label:"Go Back",onClick:v}),s.jsxs(O,{className:"flex w-full flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-row justify-between p-3",children:[s.jsx("div",{children:S}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(j,{disabled:(t==null?void 0:t.length)<1,severity:"danger",raised:!0,label:"Reset",onClick:()=>f([])}),s.jsx(j,{severity:"secondary",raised:!0,label:"Select All",onClick:()=>{const e=c.map(a=>Object.values(a.permissions));f(e.flat())}}),s.jsx(j,{disabled:(t==null?void 0:t.length)<1,raised:!0,label:"Save",onClick:()=>U()})]})]}),(t==null?void 0:t.length)<1&&s.jsx(le,{className:"self-center",severity:"error",text:"Please select atleast 1 permission!"}),s.jsx(Q,{value:c,children:I.map((e,a)=>{const{className:i,...r}=e;return s.jsx($,{className:e.header!="Module Name"?"!text-center":"",alignHeader:"center",...r},r.field)})})]})]}),s.jsx(oe,{visible:k,onHide:()=>g(!1),tableRef:u})]})};export{ve as default};
