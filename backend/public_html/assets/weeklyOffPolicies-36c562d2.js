import{v as V,ca as I,r as f,$ as F,cb as A,j as e,f as S,af as R}from"./index-3ec7abe5.js";import{C as B}from"./dropdown.esm-1ad10373.js";import{D as H,C,T as M}from"./index-b2a6305f.js";import{E as T}from"./edit-c01b3e15.js";import{P as $}from"./plus-b36a0702.js";import{T as q}from"./trash-4a28e917.js";import{C as O}from"./index-3d6f48ca.js";import{u as U,W as Q}from"./validationSchemas-9cdf4188.js";import{I as b}from"./inputtext.esm-e49a03d7.js";import{C as v}from"./checkbox.esm-7c1abfc1.js";import{B as G}from"./index-36dd5a0c.js";import{L as N}from"./index-37ade0e2.js";import{L as J,M as K,N as X,O as Y,P as Z,Q as z}from"./api-f3ada6c1.js";import{u as E}from"./useDispatch-1aeda00f.js";import"./index.esm-9e3aa09b.js";import"./paginator.esm-634e02d4.js";const ee=({visible:u,onHide:o,tableRef:p})=>{var _;const x=E(),n=V(I),[r,h]=f.useState(null),[y,k]=f.useState([]),[W,w]=f.useState([]),t=async a=>{const i=await X(a);i.data.status===200?h(i.data.data):h(null)},g=async()=>{const a=await Y();w(a.status===200?a.data.data:[])},j=a=>a.reduce((i,m)=>{const{week_name:d,week_number:l}=m;return i[d]||(i[d]=[]),i[d].push(l),i},{}),s=U({initialValues:{name:(r==null?void 0:r.name)||"",description:(r==null?void 0:r.description)||"",configuration:((_=r==null?void 0:r.weekly_off_associations)==null?void 0:_.length)>0?j(r==null?void 0:r.weekly_off_associations):{}},validationSchema:Q,onSubmit:async a=>{let i;n?i=await K(n,a):i=await J(a),(i.status===201||i.status===200)&&(P(),F.success(i.message),p.current.refreshListData())},enableReinitialize:!0}),L=[{label:n?"Update":"Add",onClick:s.handleSubmit,className:"min-w-[90px]",loading:s.isSubmitting}],P=()=>{x(A("")),h(null),s.resetForm(),o(!1)};return f.useEffect(()=>{u&&(k([{id:1,name:"1st",alias:"week_1"},{id:2,name:"2nd",alias:"week_2"},{id:3,name:"3rd",alias:"week_3"},{id:4,name:"4th",alias:"week_4"},{id:5,name:"5th",alias:"week_5"}]),g())},[u]),f.useEffect(()=>{u&&n&&t(n)},[u,n]),e.jsx(G,{header:`${n?"Update":"Add"} Weekly-Off`,visible:u,onHide:P,actions:L,children:e.jsxs("div",{className:"m-auto grid w-full gap-3 md:grid-cols-2",children:[e.jsx(N,{title:"Policy Name",required:!0,showError:s.errors.name&&s.touched.name,errorMessages:s.errors.name,children:e.jsx(b,{name:"name",value:s.values.name,className:S("w-full",{"p-invalid text-red-500":s.errors.name&&s.touched.name}),onChange:a=>s.setFieldValue("name",a.target.value)})}),e.jsx(N,{title:"Description",required:!0,showError:s.errors.description&&s.touched.description,errorMessages:s.errors.description,children:e.jsx(b,{name:"description",value:s.values.description,className:S("w-full",{"p-invalid text-red-500":s.errors.description&&s.touched.description}),onChange:a=>s.setFieldValue("description",a.target.value)})}),e.jsx(N,{className:"overflow-x-scroll md:col-span-2",required:!0,title:"Weekly-Off Configuration",children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.errors.configuration&&s.touched.configuration&&e.jsx("p",{className:"text-xs text-red-500",children:s.errors.configuration}),e.jsxs(H,{className:"w-full",value:W,children:[e.jsx(C,{field:"name",header:"Day Name"}),e.jsx(C,{header:"All",align:"center",alignHeader:"center",body:a=>{var i,m;return e.jsx(v,{name:`${a.id}_all`,inputId:`${a.id}_all`,onChange:d=>{const l={...s.values.configuration};d.checked?s.setFieldValue("configuration",{...l,[a.id]:[1,2,3,4,5]}):(delete l[a.id],s.setFieldValue("configuration",{...l}))},checked:((m=(i=s.values)==null?void 0:i.configuration[a.id])==null?void 0:m.length)===5})}}),y.map(a=>e.jsx(C,{align:"center",alignHeader:"center",header:a.name,body:i=>{var m,d;return e.jsx(v,{name:a.alias,inputId:a.alias,value:a.id,onChange:l=>{const c={...s.values.configuration};if(l.checked)c[i.id]?c[i.id].push(l.target.value):c[i.id]=[l.target.value],s.setFieldValue("configuration",c);else{const D=c[i.id].indexOf(l.target.value);D>-1&&c[i.id].splice(D,1),c[i.id].length===0&&delete c[i.id],s.setFieldValue("configuration",c)}},checked:(d=(m=s.values)==null?void 0:m.configuration[i.id])==null?void 0:d.includes(a.id)})}},a.alias))]})]})})]})})},xe=()=>{const u=E(),o=f.useRef(null),[p,x]=f.useState(""),[n,r]=f.useState(!1),h=async t=>await Z({filterBy:"search_term",filterValue:p,page:t.page+1,records:t.rows,sortBy:t.sortField?t.sortField:"",sortOrder:t.sortField?t.sortOrder===-1?"DESC":"ASC":""}),y=()=>{r(!0)},k=t=>{let g;const j=async s=>{g=await z(s),g.status===200&&(F.success(g.message),o.current.refreshListData())};return R({draggable:!1,resizable:!1,message:"Do you want to delete this record?",header:"Delete Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>j(t.id),reject:()=>{}})},w=[{field:"policy_name",header:"Weekly-Off Policy Name",sortable:!0,body:t=>t.name},{field:"description",header:"Description"},{field:"actions",align:"center",alignHeader:"center",className:"cursor-default",header:"Actions",body:t=>e.jsxs("div",{className:"flex w-full items-center justify-center gap-3",children:[e.jsx("img",{className:"cursor-pointer",width:25,height:25,src:T,onClick:()=>{u(A(t.id)),r(!0)}}),e.jsx("img",{className:"cursor-pointer",width:25,height:25,src:q,onClick:()=>k(t)})]})}];return e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("div",{className:"text-bold flex w-full px-2 pb-4 text-xl text-gray-600",children:"Weekly-Off"}),e.jsxs(B,{className:"flex w-full flex-col",children:[e.jsxs("div",{className:"my-2 flex flex-col-reverse justify-between gap-3 p-3 md:flex-row",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 md:flex-row",children:[e.jsx(b,{placeholder:"Search policy name",value:p,onChange:t=>x(t.target.value)}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(O,{icon:"pi pi-times",severity:"danger",onClick:()=>{x(""),o.current&&o.current.refreshListData()}}),e.jsx(O,{icon:"pi pi-search",disabled:!p,onClick:()=>{o.current&&o.current.refreshListData()}})]})]}),e.jsx(O,{raised:!0,label:"Add Weekly-Off",icon:e.jsx("img",{src:$}),onClick:y})]}),e.jsx(M,{dataHandler:h,id:"attendance_policies",headers:w,ref:o}),e.jsx(ee,{visible:n,onHide:()=>r(!1),tableRef:o})]})]})};export{xe as default};
