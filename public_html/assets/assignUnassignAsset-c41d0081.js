import{v as L,bT as $,r as n,G as t,$ as R,bF as q,j as i,f as d}from"./index-3ec7abe5.js";import{u as H,p as I}from"./validationSchemas-9cdf4188.js";import{I as u}from"./inputtext.esm-e49a03d7.js";import{B as k}from"./index-36dd5a0c.js";import{L as l}from"./index-37ade0e2.js";import{C as w}from"./calendar.esm-f987a87a.js";import{K as U,L as B,n as T,M as z,N as G}from"./api-9d9fddec.js";import{D as v}from"./dropdown.esm-1ad10373.js";import{u as K}from"./useDispatch-1aeda00f.js";const er=({visible:m,onHide:j,tableRef:p,newAssetId:S,employeeId:f,getUpdatedProfileData:h})=>{var x,Y,y,M;const F=K(),r=L($),[e,_]=n.useState(null),[g]=n.useState(t().format("YYYY-MM-DD")),[b,D]=n.useState([]),[E,N]=n.useState([]),C=async()=>{const o=await T(),s=await z();D(o.status===200?o.data.data:[]),N(s.status===200?s.data.data:[])},V=async o=>{const s=await G(o);s.status===200?_(s.data.data):_(null)},a=H({initialValues:{employee_id:((x=e==null?void 0:e.user)==null?void 0:x.id)||f||"",asset_id:((Y=e==null?void 0:e.asset)==null?void 0:Y.id)||S||"",date_of_issue:(e==null?void 0:e.date_of_issue)||g,date_of_return:(e==null?void 0:e.date_of_return)||g,description:(e==null?void 0:e.description)||""},validationSchema:I,onSubmit:async o=>{let s;r!=null&&r.asset_id?s=await B(r==null?void 0:r.asset_id,{date_of_return:o.date_of_return}):(delete o.date_of_return,s=await U(o.asset_id,o)),(s.status===201||s.status===200)&&(c(),R.success(s.message),p&&p.current.refreshListData(),h&&h())},enableReinitialize:!0}),O=[{label:r!=null&&r.id?"Unassign":"Assign",onClick:a.handleSubmit,className:"min-w-[90px]",loading:a.isSubmitting}],c=()=>{F(q(null)),a.resetForm(),_(null),j(!1)};return n.useEffect(()=>{m&&(r!=null&&r.id?V(r==null?void 0:r.id):C())},[m,r]),i.jsx(k,{header:`${r!=null&&r.id?"Update Assigned Asset":"Assign Asset"}`,visible:m,onHide:c,actions:O,children:i.jsxs("div",{className:"m-auto grid w-full gap-3 md:grid-cols-2",children:[i.jsxs(l,{required:!0,title:"Employee Name",showError:a.errors.employee_id&&a.touched.employee_id,errorMessages:a.errors.employee_id,children:[!(r!=null&&r.id)&&i.jsx(v,{disabled:f||(r==null?void 0:r.id),options:b,optionLabel:o=>`${o.employee_name} (${o.employee_generated_id})`,optionValue:"id",placeholder:"Select Employee",filter:!0,resetFilterOnHide:!0,filterPlaceholder:"Search Employee",value:a.values.employee_id,className:d("w-full",{"p-invalid text-red-500":a.errors.employee_id&&a.touched.employee_id}),onChange:o=>a.setFieldValue("employee_id",o.value)}),(r==null?void 0:r.id)&&i.jsx(u,{disabled:!0,value:(y=e==null?void 0:e.user)==null?void 0:y.employee_name})]}),i.jsxs(l,{required:!0,title:"Asset Name",showError:a.errors.asset_id&&a.touched.asset_id,errorMessages:a.errors.asset_id,children:[!e&&i.jsx(v,{disabled:r==null?void 0:r.id,options:E,optionLabel:o=>`${o.asset_name} (${o.asset_code})`,optionValue:"id",placeholder:"Select Asset",filter:!0,resetFilterOnHide:!0,filterPlaceholder:"Search Asset",value:a.values.asset_id,className:d("w-full",{"p-invalid text-red-500":a.errors.asset_id&&a.touched.asset_id}),onChange:o=>a.setFieldValue("asset_id",o.value)}),(r==null?void 0:r.id)&&i.jsx(u,{disabled:!0,value:(M=e==null?void 0:e.asset)==null?void 0:M.asset_name})]}),i.jsxs(l,{title:"Date Of Issue",required:!0,showError:a.errors.date_of_issue&&a.touched.date_of_issue,errorMessages:a.errors.date_of_issue,children:[!e&&i.jsx(w,{readOnlyInput:!0,disabled:r==null?void 0:r.id,dateFormat:"dd-mm-yy",maxDate:t().toDate(),value:t(a.values.date_of_issue,"YYYY-MM-DD").toDate(),className:d("w-full",{"p-invalid text-red-500":a.errors.date_of_issue&&a.touched.date_of_issue}),onChange:o=>a.setFieldValue("date_of_issue",t(o.value).format("YYYY-MM-DD"))}),(r==null?void 0:r.id)&&i.jsx(u,{disabled:!0,value:t(e==null?void 0:e.date_of_issue).format("DD MMMM YYYY")})]}),(r==null?void 0:r.id)&&i.jsx(l,{title:"Date Of Return",required:!0,showError:a.errors.date_of_return&&a.touched.date_of_return,errorMessages:a.errors.date_of_return,children:i.jsx(w,{readOnlyInput:!0,minDate:e!=null&&e.date_of_issue?t(e==null?void 0:e.date_of_issue,"YYYY-MM-DD").toDate():t().toDate(),maxDate:t().toDate(),dateFormat:"dd-mm-yy",value:t(a.values.date_of_return,"YYYY-MM-DD").toDate(),className:d("w-full",{"p-invalid text-red-500":a.errors.date_of_return&&a.touched.date_of_return}),onChange:o=>a.setFieldValue("date_of_return",t(o.value).format("YYYY-MM-DD"))})}),i.jsxs(l,{className:"md:col-span-2",title:"Description",showError:a.errors.description&&a.touched.description,errorMessages:a.errors.description,children:[!(r!=null&&r.id)&&i.jsx(u,{disabled:r==null?void 0:r.id,value:a.values.description,className:d("w-full",{"p-invalid text-red-500":a.errors.description&&a.touched.description}),onChange:o=>a.setFieldValue("description",o.target.value)}),(r==null?void 0:r.id)&&i.jsx(u,{disabled:!0,value:e==null?void 0:e.description})]})]})})};export{er as A};
