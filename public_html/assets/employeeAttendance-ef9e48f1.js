import{v as I,a5 as W,r as i,x as G,G as a,a6 as P,a7 as Q,$ as L,j as s,f as F,a8 as J,a9 as K,aa as k,ab as U,ac as O,T as X,ad as Z,ae as z,af as v,ag as ee,ah as se}from"./index-3ec7abe5.js";import{D as M,C as Y}from"./dropdown.esm-1ad10373.js";import{T as te}from"./index-c74eb1f3.js";import{T as B}from"./index-b2a6305f.js";import{C}from"./index-3d6f48ca.js";import{u as ae,A as re}from"./validationSchemas-9cdf4188.js";import{I as oe}from"./inputtextarea.esm-51dfddb5.js";import{B as ie}from"./index-36dd5a0c.js";import{L as A}from"./index-37ade0e2.js";import{C as H}from"./calendar.esm-f987a87a.js";import{u as V}from"./useDispatch-1aeda00f.js";import{E as le}from"./edit-c01b3e15.js";import{T as de}from"./trash-4a28e917.js";import{T as ue}from"./timesheet-358c0d98.js";import"./index.esm-9e3aa09b.js";import"./paginator.esm-634e02d4.js";import"./inputtext.esm-e49a03d7.js";import"./index.esm-be3d6ae7.js";import"./index-7054a830.js";const ce="/assets/average-in-time-649f740a.svg",ne="/assets/average-out-time-1b6f196f.svg",me="/assets/average-worked-hours-07469263.svg",fe="/assets/regularise-20040658.svg",he="/assets/regularise-request-22dea597.svg",$=({visible:d,onHide:u,tableRef:l,selectedDate:j})=>{var b;const x=V(),f=I(W),[_]=i.useState(G.getUserData()),[o,c]=i.useState(null),[g,h]=i.useState([]),w=async()=>{const t=await J();h(t.status===200?t.data.data:[])},y=async t=>{const n=await K(t);n.status===200?c(n.data.data):c(null)},D=()=>{r.resetForm(),x(k("")),c(null),u(!1)},r=ae({initialValues:{date:(o==null?void 0:o.date)||j||a().subtract(1,"days").format("YYYY-MM-DD"),in_time:(o==null?void 0:o.in_time)||a().startOf("day").add(9,"hours"),out_time:(o==null?void 0:o.out_time)||a().startOf("day").add(18,"hours"),request_status:(o==null?void 0:o.request_status)||((b=g[0])==null?void 0:b.id),reason:(o==null?void 0:o.reason)||""},validationSchema:re,onSubmit:async t=>{let n;f?n=await Q(f,t):n=await P(t),(n.status===201||n.status===200)&&(D(),L.success(n.message),l.current.refreshListData())},enableReinitialize:!0}),S=[{label:"Submit",onClick:r.handleSubmit,className:"min-w-[90px]",loading:r.isSubmitting}];return i.useEffect(()=>{d&&f&&y(f)},[d,f]),i.useEffect(()=>{d&&w()},[d]),s.jsx(ie,{header:"Regularisation Request",visible:d,onHide:D,actions:S,children:s.jsxs("div",{className:"m-auto grid w-full gap-3 md:grid-cols-2",children:[s.jsx(A,{htmlFor:"date",required:!0,title:"Date",showError:r.errors.date&&r.touched.date,errorMessages:r.errors.date,children:s.jsx(H,{readOnlyInput:!0,minDate:a(_==null?void 0:_.date_of_joining,"YYYY-MM-DD").toDate(),maxDate:a().subtract(1,"days").toDate(),disabled:(o==null?void 0:o.date)||j,dateFormat:"dd-mm-yy",value:a(r.values.date,"YYYY-MM-DD").toDate(),className:F("w-full",{"p-invalid text-red-500":r.errors.date&&r.touched.date}),onChange:t=>r.setFieldValue("date",a(t.value).format("YYYY-MM-DD"))})}),s.jsx(A,{required:!0,htmlFor:"request_status",title:"Requested Status",showError:r.errors.request_status&&r.touched.request_status,errorMessages:r.errors.request_status,children:s.jsx(M,{inputId:"request_status",options:g,optionLabel:"name",optionValue:"id",value:r.values.request_status,className:F("w-full",{"p-invalid text-red-500":r.errors.request_status&&r.touched.request_status}),onChange:t=>r.setFieldValue("request_status",t.value)})}),s.jsx(A,{htmlFor:"in_time",required:!0,title:"In Time",showError:r.errors.in_time&&r.touched.in_time,errorMessages:r.errors.in_time,children:s.jsx(H,{hourFormat:"24",readOnlyInput:!0,timeOnly:!0,name:"in_time",value:a(r.values.in_time,"HH:mm:ss").toDate(),className:F("w-full",{"p-invalid text-red-500":r.errors.in_time&&r.touched.in_time}),onChange:t=>{r.setFieldValue("in_time",a(t.value)),r.setFieldValue("out_time",a(t.value).add(9,"hours").isSameOrBefore(a("23:59:59","YYYY-MM-DD HH:mm:ss"))?a(t.value).add(9,"hours"):a(t.value))}})}),s.jsx(A,{htmlFor:"out_time",required:!0,title:"Out Time",showError:r.errors.out_time&&r.touched.out_time,errorMessages:r.errors.out_time,children:s.jsx(H,{hourFormat:"24",readOnlyInput:!0,timeOnly:!0,minDate:a(r.values.in_time,"HH:mm:ss").toDate(),name:"out_time",value:a(r.values.out_time,"HH:mm:ss").toDate(),className:F("w-full",{"p-invalid text-red-500":r.errors.out_time&&r.touched.out_time}),onChange:t=>r.setFieldValue("out_time",a(t.value))})}),s.jsx(A,{required:!0,title:"Reason",htmlFor:"reason",className:"md:col-span-2",showError:r.errors.reason&&r.touched.reason,errorMessages:r.errors.reason,children:s.jsx(oe,{name:"reason",rows:3,autoResize:!0,value:r.values.reason,className:F("w-full",{"p-invalid text-red-500":r.errors.reason&&r.touched.reason}),onChange:t=>r.setFieldValue("reason",t.target.value)})})]})})},pe=()=>{const d=i.useRef(null),[u,l]=i.useState(a().toDate()),[j,x]=i.useState([]),[f,_]=i.useState(""),[o,c]=i.useState(null),[g,h]=i.useState(!1),w=async t=>await U({month:u?a(u).month()+1:"",year:u?a(u).year():"",status:f,page:t.page+1,records:t.rows,sortBy:t.sortField?t.sortField:"",sortOrder:t.sortField?t.sortOrder===-1?"DESC":"ASC":""}),y=async()=>{const t=await O();x(t.status===200?t.data.data:[])},D=t=>t===1?"#F44336":t===2?"#BDED16":t===3?"#4CAF50":t===4||t===5?"#D9DDE2":t===6?"#8ED1EF":"#4856CC",r=t=>s.jsxs("div",{className:"flex w-full items-center justify-center gap-3",children:[t.regularisation==!1&&s.jsx("img",{className:"cursor-pointer",src:he,onClick:()=>{c(t.date),h(!0)}}),t.regularisation==!0&&s.jsxs("div",{children:[s.jsx(X,{target:".custom-target-icon"}),s.jsx("i",{className:"custom-target-icon pi pi-circle-fill",style:{fontSize:"15px",color:"#FFBF00"},"data-pr-tooltip":"Pending"})]})]}),S=(t,n)=>{if(!t||!n)return"---";const N=a(t,"YYYY-MM-DD HH:mm:ss").set({seconds:0,milliseconds:0}),R=a(n,"YYYY-MM-DD HH:mm:ss").set({seconds:0,milliseconds:0});N.isAfter(R)&&R.add(24,"hours");const q=a.duration(R.diff(N));return a.utc(q.asMilliseconds()).format("HH:mm")},b=[{field:"date",header:"Date",sortable:!0,body:t=>a(t==null?void 0:t.date).format("ddd, MMM DD, YYYY")},{field:"punch_in_time",header:"In Time",sortable:!0,body:t=>t!=null&&t.punch_in_time?a.utc(t.punch_in_time,"YYYY-MM-DD HH:mm:ss").local().format("hh:mm A"):"---"},{field:"punch_out_time",header:"Out Time",sortable:!0,body:t=>t!=null&&t.punch_out_time?a.utc(t.punch_out_time,"YYYY-MM-DD HH:mm:ss").local().format("hh:mm A"):"---"},{field:"hours_worked",header:"Hours Worked",body:t=>S(t==null?void 0:t.punch_in_time,t==null?void 0:t.punch_out_time)},{field:"overtime_hours",header:"Overtime Hours",body:t=>(t==null?void 0:t.overtime_hours)||"N/A"},{field:"deficit_hours",header:"Deficit_hours",body:t=>(t==null?void 0:t.deficit_hours)||"N/A"},{field:"status",header:"Status",sortable:!0,body:t=>{var n,N;return s.jsxs("div",{className:"inline-flex items-center justify-center gap-[0.375rem]",children:[s.jsx("div",{className:`h-[0.75rem] w-[0.75rem] rounded-[0.125rem] bg-[${D((n=t==null?void 0:t.attendance_status)==null?void 0:n.id)}]`}),s.jsx("span",{className:"text-sm",children:((N=t==null?void 0:t.attendance_status)==null?void 0:N.name)||"Other"})]})}},{field:"actions",align:"center",alignHeader:"center",className:"cursor-default",header:"Regularise",body:r}];return i.useEffect(()=>{y()},[]),i.useEffect(()=>{d.current&&d.current.refreshListData()},[u]),s.jsxs("div",{className:"flex w-full flex-col",children:[s.jsxs("div",{className:"my-2 flex flex-col-reverse justify-between gap-3 p-3 md:flex-row",children:[s.jsxs("div",{className:"flex flex-col items-center gap-3 md:flex-row",children:[s.jsx(H,{name:"filter_date",className:"w-full md:!min-w-fit",readOnlyInput:!0,view:"month",dateFormat:"M yy",placeholder:"Select month",maxDate:a().toDate(),value:u,onChange:t=>l(t.value)}),s.jsx(M,{className:"w-full md:!w-fit",name:"attendance_statuses",placeholder:"Select status",options:j,optionLabel:"name",optionValue:"id",value:f,onChange:t=>_(t.value)}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(C,{icon:"pi pi-times",severity:"danger",disabled:!f,onClick:()=>{_(""),d.current&&d.current.refreshListData()}}),s.jsx(C,{icon:"pi pi-search",disabled:!f,onClick:()=>{d.current&&d.current.refreshListData()}})]})]}),s.jsx(C,{icon:s.jsx("img",{className:"mr-2",src:fe}),raised:!0,label:"Regularise",className:"px-3",onClick:()=>{h(!0)}})]}),s.jsx(B,{dataHandler:w,id:"attendance_policies",headers:b,ref:d}),s.jsx($,{visible:g,onHide:()=>{h(!1),c(null)},tableRef:d,selectedDate:o})]})},xe=()=>{const d=V(),u=i.useRef(null),[l,j]=i.useState(!1),[x,f]=i.useState(a().toDate()),[_,o]=i.useState([]),[c,g]=i.useState(""),[h,w]=i.useState(""),[y,D]=i.useState([]),r=async e=>await Z({month:x?a(x).month()+1:"",year:x?a(x).year():"",filterBy:c,filterValue:h,page:e.page+1,records:e.rows,sortBy:e.sortField?e.sortField:"",sortOrder:e.sortField?e.sortOrder===-1?"DESC":"ASC":""}),S=async()=>{const e=await z(),m=await O();o(e.status===200?e.data.data:[]),m.status===200?D(m.data.data):D([])},b=e=>{const m=async p=>{const T=await ee(p);T.status===200&&(L.success(T.message),u.current.refreshListData())};return v({draggable:!1,resizable:!1,message:s.jsx("p",{children:"Do you want to delete this request?"}),header:"Delete Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>m(e.id),reject:()=>{}})},t=e=>!(e!=null&&e.recorded_in_time)&&!(e!=null&&e.recorded_out_time)?"---":!(e!=null&&e.recorded_in_time)&&(e!=null&&e.recorded_out_time)?`N/A - ${a(e==null?void 0:e.recorded_out_time,"HH:mm:ss").format("hh:mm A")}`:e!=null&&e.recorded_in_time&&!(e!=null&&e.recorded_out_time)?`${a(e==null?void 0:e.recorded_in_time,"HH:mm:ss").format("hh:mm A")} - N/A`:`${a(e==null?void 0:e.recorded_in_time).format("hh:mm A")} - ${a(e==null?void 0:e.recorded_out_time).format("hh:mm A")}`,n=e=>`${a(e==null?void 0:e.in_time).utc().local().format("hh:mm A")} - ${a(e==null?void 0:e.out_time).utc().local().format("hh:mm A")}`,N=e=>{var m,p;return s.jsxs("div",{className:"flex w-full items-center justify-center gap-3",children:[((m=e==null?void 0:e.approval_status)==null?void 0:m.id)==1&&s.jsxs(s.Fragment,{children:[s.jsx("img",{className:"cursor-pointer",width:25,height:25,src:le,onClick:()=>{d(k(e.id)),j(!0)}}),s.jsx("img",{className:"cursor-pointer",width:25,height:25,src:de,onClick:()=>b(e)})]}),((p=e==null?void 0:e.approval_status)==null?void 0:p.id)!=1&&s.jsx("span",{children:"---"})]})},R=e=>{if(e==1)return"F6BB42";if(e==2)return"00B087";if(e==3)return"FF684F"},q=e=>{if(e==1)return"F44336";if(e==2)return"BDED16";if(e==3)return"4CAF50";if(e==4)return"D9DDE2"},E=[{field:"date",header:"Date",sortable:!0,body:e=>a(e.date).format("ddd, MMM DD, YYYY")},{field:"recorded_time",header:"Recorded Time",body:t},{field:"requested_time",header:"Requested Time",body:n},{field:"recorded_status",header:"Recorded Status",body:e=>{var m,p;return s.jsxs("div",{className:"inline-flex items-center justify-center gap-[0.375rem]",children:[s.jsx("div",{className:`h-[0.75rem] w-[0.75rem] rounded-[0.125rem] bg-[#${q((m=e==null?void 0:e.recorded_status)==null?void 0:m.id)}]`}),s.jsx("span",{className:"text-sm",children:((p=e==null?void 0:e.recorded_status)==null?void 0:p.name)||"---"})]})}},{field:"request_status",header:"Requested Status",sortable:!0,body:e=>{var m,p;return s.jsxs("div",{className:"inline-flex items-center justify-center gap-[0.375rem]",children:[s.jsx("div",{className:`h-[0.75rem] w-[0.75rem] rounded-[0.125rem] bg-[#${q((m=e==null?void 0:e.Request_status)==null?void 0:m.id)}]`}),s.jsx("span",{className:"text-sm",children:((p=e==null?void 0:e.Request_status)==null?void 0:p.name)||"---"})]})}},{field:"status",header:"Status",sortable:!0,body:e=>{var m,p;return s.jsxs("div",{className:"inline-flex items-center justify-center gap-[0.375rem]",children:[s.jsx("div",{className:`h-[0.75rem] w-[0.75rem] rounded-[0.125rem] bg-[#${R((m=e==null?void 0:e.approval_status)==null?void 0:m.id)}]`}),s.jsx("span",{className:"text-sm",children:(p=e==null?void 0:e.approval_status)==null?void 0:p.name})]})}},{field:"actions",align:"center",alignHeader:"center",className:"cursor-default",header:"Actions",body:N}];return i.useEffect(()=>{S()},[]),i.useEffect(()=>{u.current&&u.current.refreshListData()},[x]),s.jsxs("div",{className:"flex w-full flex-col",children:[s.jsx("div",{className:"my-2 flex flex-col-reverse justify-between p-3 md:flex-row",children:s.jsxs("div",{className:"flex flex-col items-center gap-3 md:flex-row",children:[s.jsx(H,{name:"filter_date",className:"w-full md:!w-fit",readOnlyInput:!0,view:"month",dateFormat:"M yy",placeholder:"Select date",maxDate:a().toDate(),value:x||a().toDate(),onChange:e=>{g(""),w(""),f(e.value)}}),c==="status"&&s.jsx(M,{className:"w-full md:!w-fit",name:"attendance_statuses",placeholder:"Select status",options:_,optionLabel:"name",optionValue:"id",value:h,onChange:e=>w(e.value)}),(c==="recorded_status"||c==="requested_status")&&s.jsx(M,{className:"w-full md:!w-fit",placeholder:"Select Status",options:y,optionLabel:"name",optionValue:"id",value:h,onChange:e=>w(e.value)}),s.jsx(M,{placeholder:"Filter by",className:"w-full md:!w-fit",options:[{label:"Recorded Status",code:"recorded_status"},{label:"Requested Status",code:"requested_status"},{label:"Status",code:"status"}],optionLabel:"label",optionValue:"code",value:c,onChange:e=>{w(""),g(e.value)}}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(C,{icon:"pi pi-times",severity:"danger",disabled:!c,onClick:()=>{g(""),w(""),u.current&&u.current.refreshListData()}}),s.jsx(C,{icon:"pi pi-search",disabled:!c||!h,onClick:()=>{u.current&&u.current.refreshListData()}})]})]})}),s.jsx(B,{dataHandler:r,id:"attendance_policies",headers:E,ref:u}),s.jsx($,{visible:l,onHide:()=>{j(!1)},tableRef:u})]})},Le=()=>{const[d,u]=i.useState(0),[l,j]=i.useState(null),x=async()=>{const o=await se();j(o.status===200?o.data.data:null)},f=[{id:1,label:"Attendance Logs"},{id:2,label:"Regularisation Status"}],_=o=>{const c=a.duration(o,"minutes"),g=Math.floor(c.asHours()),h=c.minutes();return s.jsxs("span",{children:[g,s.jsx("sup",{children:g>1?"Hrs":"Hr"})," ",h,s.jsx("sup",{children:(h>1,"Mins")})]})};return i.useEffect(()=>{x()},[]),s.jsxs("div",{className:"m-auto grid w-full gap-3 md:grid-cols-8",children:[s.jsxs(Y,{className:"flex w-full flex-col gap-5 overflow-hidden md:col-span-6",children:[s.jsx(te,{activeIndex:d,onTabChange:o=>u(o.index),model:f}),d===0&&s.jsx(pe,{}),d===1&&s.jsx(xe,{})]}),s.jsxs("div",{className:"m-auto grid h-full w-full gap-3 md:col-span-2",children:[s.jsx(Y,{className:" flex-col gap-3 p-3 md:col-span-2",children:s.jsx(ue,{})}),s.jsxs(Y,{className:" flex-col p-3 md:col-span-2",children:[s.jsxs("div",{className:"mb-2 flex flex-col",children:[s.jsx("p",{name:"card-heading",className:"w-full text-center text-lg text-[#37B3E0]",children:"Attendance Summary"}),s.jsx("p",{name:"card-heading",className:"w-full text-center text-sm",children:a().format("MMMM yyyy")})]}),s.jsxs("div",{className:"flex w-full justify-between gap-3 p-2",children:[s.jsx("img",{className:"h-[50px] w-[50px] self-center",src:ce}),s.jsxs("div",{className:"flex flex-col items-end justify-center",children:[s.jsx("p",{className:"text-center text-sm",children:l!=null&&l.average_in_time?s.jsxs("span",{children:[a(l.average_in_time,"HH:mm:ss").format("hh:mm A").split(" ")[0],s.jsx("sup",{children:a(l.average_in_time,"HH:mm:ss").format("hh:mm A").split(" ")[1]})]}):"N/A"}),s.jsx("p",{className:"text-xs",children:"Average In Time"})]})]}),s.jsxs("div",{className:"flex w-full justify-between gap-3 p-2",children:[s.jsx("img",{className:"h-[50px] w-[50px] self-center",src:ne}),s.jsxs("div",{className:"flex flex-col items-end justify-center",children:[s.jsx("p",{className:"text-center text-sm",children:l!=null&&l.average_out_time?s.jsxs("span",{children:[a(l.average_out_time,"HH:mm:ss").format("hh:mm A").split(" ")[0],s.jsx("sup",{children:a(l.average_out_time,"HH:mm:ss").format("hh:mm A").split(" ")[1]})]}):"N/A"}),s.jsx("p",{className:"text-xs",children:"Average Out Time"})]})]}),s.jsxs("div",{className:"flex w-full justify-between gap-3 p-2",children:[s.jsx("img",{className:"h-[50px] w-[50px] self-center",src:me}),s.jsxs("div",{className:"flex flex-col items-end justify-center",children:[s.jsx("p",{className:"text-center text-sm",children:l!=null&&l.avgWorkDurationInMinutes?_(l==null?void 0:l.avgWorkDurationInMinutes):"N/A"}),s.jsx("p",{className:"text-end text-xs",children:"Average Work Duration"})]})]})]})]})]})};export{Le as default};
