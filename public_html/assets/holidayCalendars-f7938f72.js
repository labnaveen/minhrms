import{v as M,cc as E,r as o,G as n,$ as A,cd as F,j as e,f as k,ce as P,cf as W,B as Q,af as X}from"./index-3ec7abe5.js";import{C as D}from"./dropdown.esm-1ad10373.js";import{D as Z,C as J,T as R}from"./index-b2a6305f.js";import{A as K}from"./arrow-back-2554853d.js";import{E as O}from"./edit-c01b3e15.js";import{E as z}from"./eye-open-81f9d166.js";import{P as V}from"./plus-b36a0702.js";import{T}from"./trash-4a28e917.js";import{C as w}from"./index-3d6f48ca.js";import{u as q,H as ee,x as ae}from"./validationSchemas-9cdf4188.js";import{I as N}from"./inputtext.esm-e49a03d7.js";import{C as se}from"./checkbox.esm-7c1abfc1.js";import{C as U}from"./calendar.esm-f987a87a.js";import{R as re,S as le,T as te,U as de,V as ie,W as oe,X as ne,Y as ce,Z as ue,_ as me,$ as he,a0 as fe}from"./api-f3ada6c1.js";import{B as $}from"./index-36dd5a0c.js";import{L as b}from"./index-37ade0e2.js";import{u as L}from"./useDispatch-1aeda00f.js";import"./index.esm-9e3aa09b.js";import"./paginator.esm-634e02d4.js";import"./index.esm-be3d6ae7.js";const ye=({visible:f,onHide:x,tableRef:p})=>{const d=L(),i=M(E),[c,u]=o.useState(null),[g,C]=o.useState([]),[H]=o.useState(n().format("YYYY")),l=async r=>{const t=await te({year:r});C(t.status===200?t.data.data.filter(y=>!(y!=null&&y.custom_holiday)):[])},j=async r=>{const t=await de(r);t.status===200?u(t.data.data):u(null)},s=q({initialValues:{name:(c==null?void 0:c.name)||"",year:(c==null?void 0:c.year)||H,holiday_id:(c==null?void 0:c.holiday_databases.map(r=>r.id))||[]},validationSchema:ee,onSubmit:async r=>{let t;i?t=await le(i,{...r,year:n(r.year).year()}):t=await re(r),(t.status===201||t.status===200)&&(h(),A.success(t.message),p.current.refreshListData())},enableReinitialize:!0}),m=[{label:i?"Update":"Add",onClick:s.handleSubmit,className:"min-w-[90px]",loading:s.isSubmitting}],h=()=>{d(F("")),s.resetForm(),u(null),C([]),x(!1)},S=[{field:"name",header:"Holiday Name",sortable:!0,body:r=>r.name},{field:"date",header:"Date",sortable:!0,body:r=>n(r.date).format("ddd, DD MMMM yyyy")},{field:"actions",align:"center",alignHeader:"center",className:"cursor-default",header:"Select/Deselect",body:r=>e.jsx(se,{name:r.name,value:r.id,checked:s.values.holiday_id.includes(r.id),onChange:t=>{const y=[...s.values.holiday_id];if(t.checked)y.push(t.target.value);else{const v=y.indexOf(t.target.value);v>-1&&y.splice(v,1)}s.setFieldValue("holiday_id",y)}})}];return o.useEffect(()=>{f&&s.values.year&&l(n(s.values.year).year())},[f,s.values.year]),o.useEffect(()=>{f&&i&&j(i)},[f,i]),e.jsx($,{header:`${i?"Update":"Add"} Holiday Calendar`,visible:f,onHide:h,actions:m,children:e.jsxs("div",{className:"z-0 m-auto grid w-full grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsx(b,{required:!0,title:"Holiday Calendar Name",showError:s.errors.name&&s.touched.name,errorMessages:s.errors.name,children:e.jsx(N,{name:"name",value:s.values.name,className:k("w-full",{"p-invalid text-red-500":s.errors.name&&s.touched.name}),onChange:r=>s.setFieldValue("name",r.target.value)})}),!i&&e.jsx(b,{required:!0,title:"Select Year",showError:s.errors.year&&s.touched.year,errorMessages:s.errors.year,children:e.jsx(U,{readOnlyInput:!0,placeholder:"Select a year",value:n(s.values.year,"YYYY").toDate(),className:k("w-full",{"p-invalid text-red-500":s.errors.year&&s.touched.year}),onChange:r=>{s.setFieldValue("year",n(r.value).format("YYYY")),s.setFieldValue("holiday_id",[])},view:"year",dateFormat:"yy"})}),i&&e.jsx(b,{required:!0,title:"Year",children:e.jsx(N,{disabled:!0,placeholder:"Select a year",value:n(s.values.year,"YYYY").year()})}),s.errors.holiday_id&&s.touched.holiday_id&&e.jsx("span",{className:"text-xs text-red-600",children:s.errors.holiday_id}),e.jsx(D,{className:"z-50 flex w-full flex-col overflow-hidden md:col-span-2",children:e.jsx(Z,{id:"year_wise_holidays_list",value:g,children:S.map(({className:r,field:t,...y})=>e.jsx(J,{className:`p-3 text-sm ${r||""}`,field:t,...y},t))})})]})})},xe=({visible:f,onHide:x,tableRef:p,selectedCalendarData:d})=>{const i=L(),c=M(E),u=M(P);o.useState(n().format("YYYY-MM-DD"));const[g,C]=o.useState(null),H=async m=>{const h=await ne(m);h.status===200?C(h.data.data):C(null)},l=q({initialValues:{holiday_calendar_id:c,name:(g==null?void 0:g.name)||"",date:(g==null?void 0:g.date)||n(d==null?void 0:d.year,"YYYY").format("YYYY-MM-DD")},validationSchema:ae,onSubmit:async m=>{let h;u?h=await oe(u,m):h=await ie(m),(h.status===201||h.status===200)&&(s(),A.success(h.message),p.current.refreshListData())},enableReinitialize:!0}),j=[{label:u?"Update":"Add",onClick:l.handleSubmit,className:"min-w-[90px]",loading:l.isSubmitting}],s=()=>{i(W("")),l.resetForm(),C(null),x(!1)};return o.useEffect(()=>{u&&H(u)},[u]),e.jsx($,{header:`${u?"Update":"Add"} Calendar Holiday`,visible:f,onHide:s,actions:j,children:e.jsxs("div",{className:"m-auto grid w-full grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsx(b,{htmlFor:"name",required:!0,title:"Holiday Name",showError:l.errors.name&&l.touched.name,errorMessages:l.errors.name,children:e.jsx(N,{id:"name",value:l.values.name,className:k("w-full",{"p-invalid text-red-500":l.errors.name&&l.touched.name}),onChange:m=>l.setFieldValue("name",m.target.value)})}),e.jsx(b,{htmlFor:"date",required:!0,title:"Holiday Date",showError:l.errors.date&&l.touched.date,errorMessages:l.errors.date,children:e.jsx(U,{minDate:n(d==null?void 0:d.year,"YYYY").toDate(),maxDate:n(d==null?void 0:d.year,"YYYY").endOf("year").toDate(),readOnlyInput:!0,dateFormat:"dd-mm-yy",value:n(l.values.date,"YYYY-MM-DD").toDate(),className:k("w-full",{"p-invalid text-red-500":l.errors.date&&l.touched.date}),onChange:m=>l.setFieldValue("date",n(m.value).format("YYYY-MM-DD"))})})]})})},Ie=()=>{const f=L(),x=o.useRef(null),p=o.useRef(null),[d,i]=o.useState(""),c=M(E),[u,g]=o.useState(null),[C,H]=o.useState(!1),[l,j]=o.useState(!1),[s,m]=o.useState(!1),h=async a=>await ce({filterBy:"search_term",filterValue:d,page:a.page+1,records:a.rows,sortBy:a.sortField?a.sortField:"",sortOrder:a.sortField?a.sortOrder===-1?"DESC":"ASC":""}),B=async a=>await ue({holidayCalendarId:c,filterBy:"search_term",filterValue:d,page:a.page+1,records:a.rows,sortBy:a.sortField?a.sortField:"",sortOrder:a.sortField?a.sortOrder===-1?"DESC":"ASC":""}),S=a=>{let Y;const G=async _=>{s?_.custom_holiday?Y=await fe(_.id):Y=await he(c,_.id):Y=await me(_.id),Y.status===200&&(A.success(Y.message),s?p.current.refreshListData():x.current.refreshListData())};return X({draggable:!1,resizable:!1,message:"Do you want to delete this record?",header:"Delete Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>G(a),reject:()=>{}})},r=a=>e.jsxs("div",{className:"flex w-full items-center justify-center gap-3",children:[e.jsx("img",{className:"cursor-pointer",width:25,height:25,src:z,onClick:()=>{i(""),f(F(a.id)),g(a),m(!0)}}),e.jsx("img",{className:"cursor-pointer",width:25,height:25,src:O,onClick:()=>{f(F(a.id)),H(!0)}}),e.jsx("img",{className:"cursor-pointer",width:25,height:25,src:T,onClick:()=>S(a)})]}),t=a=>e.jsxs("div",{className:"flex w-full items-center justify-center gap-3",children:[(a==null?void 0:a.custom_holiday)&&e.jsx("img",{className:"cursor-pointer",width:25,height:25,src:O,onClick:()=>{f(W(a.id)),j(!0)}}),e.jsx("img",{className:"cursor-pointer",width:25,height:25,src:T,onClick:()=>S(a)})]}),y=[{field:"name",header:"Holiday Calendar Name",sortable:!0,body:a=>a.name},{field:"year",header:"Year",sortable:!0,body:a=>n(a.year).year()},{field:"actions",align:"center",alignHeader:"center",className:"cursor-default",header:"Actions",body:r}],v=[{field:"holiday_name",header:"Holiday Name",sortable:!0,body:a=>a.name},{field:"holiday_date",header:"Holiday Date",sortable:!0,body:a=>n(a.date).format("dddd, DD MMMM yyyy")},{field:"custom_holiday",header:"Custom Holiday",body:a=>a!=null&&a.custom_holiday?"Yes":"No"},{field:"actions",align:"center",alignHeader:"center",className:"cursor-default",header:"Actions",body:t}],I=()=>{s?j(!0):H(!0)};return e.jsxs("div",{className:"flex w-full flex-col",children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-bold flex w-full px-2 pb-4 text-xl text-gray-600",children:"Holiday Calendar"}),e.jsxs(D,{className:"flex w-full flex-col",children:[e.jsxs("div",{className:"my-2 flex flex-col-reverse justify-between gap-3 p-3 md:flex-row",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 md:flex-row",children:[e.jsx(N,{placeholder:"Calendar Name/Year",value:d,onChange:a=>i(a.target.value)}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(w,{icon:"pi pi-times",severity:"danger",onClick:()=>{i(""),x.current&&x.current.refreshListData()}}),e.jsx(w,{icon:"pi pi-search",disabled:!d,onClick:()=>{x.current&&x.current.refreshListData()}})]})]}),e.jsx(w,{raised:!0,label:"Add Holiday Calendar",icon:e.jsx("img",{src:V}),onClick:I})]}),e.jsx(R,{dataHandler:h,id:"holiday_calendar_list",headers:y,ref:x})]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-max gap-2 border-none px-0 !font-extralight !text-black shadow-none",icon:e.jsx("img",{src:K}),link:!0,label:"Go Back",onClick:()=>{i(""),f(F("")),g(null),m(!1)}}),e.jsxs(D,{className:"flex w-full flex-col",children:[e.jsxs("div",{className:"my-2 flex flex-col-reverse justify-between gap-3 p-3 md:flex-row",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 md:flex-row",children:[e.jsx(N,{placeholder:"Search holiday name",value:d,onChange:a=>i(a.target.value)}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(w,{icon:"pi pi-times",severity:"danger",onClick:()=>{i(""),p.current&&p.current.refreshListData()}}),e.jsx(w,{icon:"pi pi-search",disabled:!d,onClick:()=>{p.current&&p.current.refreshListData()}})]})]}),e.jsx(w,{raised:!0,label:"Add Custom Holiday",icon:e.jsx("img",{src:V}),onClick:I})]}),e.jsx(R,{dataHandler:B,id:"holiday_calendar_holidays_list",headers:v,ref:p})]})]}),e.jsx(ye,{visible:C,onHide:()=>H(!1),tableRef:x}),e.jsx(xe,{visible:l,onHide:()=>j(!1),tableRef:p,selectedCalendarData:u})]})};export{Ie as default};
