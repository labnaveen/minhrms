import{$ as F,j as e,f as $,af as B,r as o,G as P}from"./index-3ec7abe5.js";import{C as I}from"./dropdown.esm-1ad10373.js";import{T as J}from"./index-b2a6305f.js";import{A as W,P as V,R as G}from"./rejected_expenses-cb75fdf8.js";import{P as Q}from"./chart.esm-d108b7db.js";import{C as Y}from"./index-3d6f48ca.js";import{r as U,a as H,f as X,g as K}from"./api-9fc8da4c.js";import{a as Z,I as z}from"./index.esm-66734f9f.js";import{B as O}from"./index-36dd5a0c.js";import{u as D,r as ee}from"./validationSchemas-9cdf4188.js";import{I as L}from"./inputtextarea.esm-51dfddb5.js";import{L as r}from"./index-37ade0e2.js";import{I as i}from"./inputtext.esm-e49a03d7.js";import"./index.esm-9e3aa09b.js";import"./paginator.esm-634e02d4.js";import"./iconBase-2780a5a8.js";const se=({visible:n,onHide:x,tableRef:j,expenseData:s,onSuccess:b})=>{var h,d;const a=D({initialValues:{comment:""},validationSchema:ee(),onSubmit:async m=>{const u=await U(s.id,m);u.status===200&&(c(),F.success(u.message),j.current.refreshListData(),b())},enableReinitialize:!0}),c=()=>{x()},g=[{label:"No",onClick:c,className:"px-3 py-2 w-fit p-button-link"},{label:"Yes",severity:"danger",loading:a.isSubmitting,onClick:a.handleSubmit,className:"px-3 py-2 w-fit"}];return e.jsx(O,{className:"md:w-[30%]",header:"Rejection Confirmation",visible:n,onHide:c,actions:g,children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsxs("p",{children:["Reject expense request for ",e.jsx("span",{className:"font-bold",children:(d=(h=s==null?void 0:s.expense)==null?void 0:h.user)==null?void 0:d.employee_name}),"?"]}),e.jsx(r,{required:!0,title:"Reason",htmlFor:"comment",showError:a.errors.comment&&a.touched.comment,errorMessages:a.errors.comment,children:e.jsx(L,{name:"comment",rows:2,autoResize:!0,className:$("w-full",{"p-invalid text-red-500":a.errors.comment&&a.touched.comment}),onChange:m=>{a.setFieldValue("comment",m.target.value)}})})]})})},te=({visible:n,onHide:x,tableRef:j,expenseData:s,onReject:b,onApprove:a})=>{var m,u,N,v,y,w,R,E,f,C,_,S,A,k,q,M,t;const c=()=>{x()},d=[{label:"Approve",onClick:async()=>{console.log("EXPENSE",s);let l;const p=async T=>{l=await H(T),l.status===200&&(F.success(l.message),j.current.refreshListData(),a())};return B({draggable:!1,resizable:!1,message:"Do you want to approve this expense?",header:"Approval Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>p(s.id),reject:()=>{}})},className:"px-3 py-2 w-fit"},{label:"Reject",severity:"danger",onClick:l=>{b()},className:"px-3 py-2 w-fit"}];return e.jsx(O,{className:"md:w-[30%]",header:"Expense Details",visible:n,onHide:c,actions:d,children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-3 m-auto w-full",children:[e.jsx(r,{title:"Purpose",className:"font-semibold",children:e.jsx(i,{value:(u=(m=s==null?void 0:s.expense)==null?void 0:m.expencesPurpuse)==null?void 0:u.name,disabled:!0})}),e.jsx(r,{title:"Category",className:"font-semibold",children:e.jsx(i,{value:(v=(N=s==null?void 0:s.expense)==null?void 0:N.expencesCategory)==null?void 0:v.category_name,disabled:!0})}),e.jsx(r,{title:"Merchant Name",className:"font-semibold",children:e.jsx(i,{value:(y=s==null?void 0:s.expense)==null?void 0:y.merchant_name,disabled:!0})}),e.jsx(r,{title:"Amount",className:"font-semibold",children:e.jsx(i,{value:(w=s==null?void 0:s.expense)==null?void 0:w.amount,disabled:!0})}),e.jsx(r,{title:"Transaction Date",className:"font-semibold",children:e.jsx(i,{value:(R=s==null?void 0:s.expense)==null?void 0:R.transaction_date,disabled:!0})}),e.jsx(r,{title:"Bill No",className:"font-semibold",children:e.jsx(i,{value:(E=s==null?void 0:s.expense)!=null&&E.bill_no?(f=s==null?void 0:s.expense)==null?void 0:f.bill_no:"NA",disabled:!0})}),((C=s==null?void 0:s.expense)==null?void 0:C.category_id)==1&&e.jsxs(e.Fragment,{children:[e.jsx(r,{title:"Start Date",className:"font-semibold",children:e.jsx(i,{value:(_=s==null?void 0:s.expense)==null?void 0:_.stay_from_date,disabled:!0})}),e.jsx(r,{title:"End Date",className:"font-semibold",children:e.jsx(i,{value:(S=s==null?void 0:s.expense)==null?void 0:S.stay_to_date,disabled:!0})})]}),((A=s==null?void 0:s.expense)==null?void 0:A.category_id)==3&&e.jsxs(e.Fragment,{children:[e.jsx(r,{title:"From",className:"font-semibold",children:e.jsx(i,{value:(k=s==null?void 0:s.expense)==null?void 0:k.from_location,disabled:!0})}),e.jsx(r,{title:"To",className:"font-semibold",children:e.jsx(i,{value:(q=s==null?void 0:s.expense)==null?void 0:q.to_location,disabled:!0})}),e.jsx(r,{title:"Total Distance",className:"font-semibold",children:e.jsx(i,{value:`${(M=s==null?void 0:s.expense)==null?void 0:M.total_distance} km`,disabled:!0})})]}),e.jsx(r,{title:"Note",className:"font-semibold col-span-2",children:e.jsx(L,{value:(t=s==null?void 0:s.expense)==null?void 0:t.note,disabled:!0,className:"w-full"})})]})})},le="https://api.minhrms.com/",ve=()=>{const n=o.useRef(null),[x,j]=o.useState({}),[s,b]=o.useState({}),[a,c]=o.useState(!1),[g,h]=o.useState(null),[d,m]=o.useState(null),[u,N]=o.useState(0),[v,y]=o.useState(0),[w,R]=o.useState(0),[E,f]=o.useState(!1),C=async t=>await X({page:t.page+1,records:t.rows,sortBy:t.sortField?t.sortField:"",sortOrder:t.sortField?t.sortOrder===-1?"DESC":"ASC":""}),_=t=>{var l;return e.jsx("div",{className:"flex items-center justify-center gap-3",children:e.jsx("a",{href:`${le+((l=t==null?void 0:t.expense.document)==null?void 0:l.public_url)}`,target:"_blank",children:e.jsx(z,{className:"text-2xl cursor-pointer"})})})},S=async()=>{const t=await K();if(t.status==200){const l=[];t.data.data.data.map(p=>{l.push(parseInt(p.total_amount))}),m(l),R(t.data.data.approved),N(t.data.data.pending),y(t.data.data.rejected)}};console.log(">>>>",d),o.useEffect(()=>{S()},[]);const A=t=>{h(t),f(!0)},k=async t=>{let l;const p=async T=>{l=await H(T),l.status===200&&(F.success(l.message),n.current.refreshListData())};return B({draggable:!1,resizable:!1,message:"Do you want to approve this expense?",header:"Approval Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>p(t.id),reject:()=>{}})},q=t=>{h(t),c(!0)},M=[{field:"request_date",header:"Applied On",sortable:!0,body:t=>P(t.request_date).format("ddd, MMM DD, YYYY")},{field:"requester",header:"Requester",sortable:!0,body:t=>e.jsx("p",{children:t.expense.user.employee_name})},{field:"bill_date",header:"Transaction Date",sortable:!0,body:t=>P(t.expense.transaction_date).format("ddd, MMM DD, YYYY")},{field:"bill_number",header:"Bill No.",body:t=>t.expense.bill_no},{field:"price",header:"Price",body:t=>`₹${t.expense.amount}`},{field:"supporting_docs",header:"Supporting Docs",sortable:!0,body:t=>t.expense.document?_(t):"---"},{field:"note",header:"Notes",body:t=>t.expense.note||"---"},{field:"actions",header:"Actions",alignHeader:"center",body:t=>e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row justify-center",children:[e.jsx(Z,{className:"text-4xl cursor-pointer",onClick:()=>A(t)}),e.jsx(Y,{onClick:()=>k(t),className:"w-full text-sm hover:scale-110 md:w-fit",outlined:!0,label:"Approve",severity:"success"}),e.jsx(Y,{onClick:()=>q(t),className:"w-full text-sm hover:scale-110 md:w-fit",outlined:!0,label:"Reject",severity:"danger"})]})}];return o.useEffect(()=>{const t={labels:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],datasets:[{data:d,backgroundColor:["#37B3E0"],barThickness:25,borderWidth:1}]},l={plugins:{legend:{display:!1}},scales:{x:{grid:{display:!1}},y:{grid:{display:!1},ticks:{callback:(p,T,re)=>`₹${p}`}}},responsive:!0,maintainAspectRatio:!1};j(t),b(l)},[d]),e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsxs(I,{className:"flex-col gap-3 p-3",children:[e.jsx("div",{className:"flex w-full justify-between",children:e.jsx("p",{name:"card-heading",className:"my-auto text-center text-[#37B3E0]",children:"Reimbursements Summary"})}),e.jsxs("div",{className:"m-0 grid w-full justify-center gap-3 md:grid-cols-8",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:col-span-2",children:[e.jsxs("div",{className:"flex w-full gap-3",children:[e.jsx("img",{className:"h-[50px] w-[50px] self-center",src:W}),e.jsxs("div",{className:"flex w-full flex-col justify-center",children:[e.jsx("p",{className:"text-right text-sm",children:e.jsxs("span",{children:["₹",e.jsx("span",{children:w})]})}),e.jsx("p",{className:"text-right text-xs",children:"Approved Expenses"})]})]}),e.jsxs("div",{className:"flex w-full gap-3",children:[e.jsx("img",{className:"h-[50px] w-[50px] self-center",src:V}),e.jsxs("div",{className:"flex w-full flex-col justify-center",children:[e.jsx("p",{className:"text-right text-sm",children:e.jsxs("span",{children:["₹",e.jsx("span",{children:u})]})}),e.jsx("p",{className:"text-right text-xs",children:"Pending Expenses"})]})]}),e.jsxs("div",{className:"flex h-max w-full gap-3",children:[e.jsx("img",{className:"h-[50px] w-[50px] self-center",src:G}),e.jsxs("div",{className:"flex w-full flex-col justify-center",children:[e.jsx("p",{className:"text-right text-sm",children:e.jsxs("span",{children:["₹",e.jsx("span",{children:v})]})}),e.jsx("p",{className:"text-right text-xs",children:"Rejected Expenses"})]})]})]}),e.jsx("div",{className:"relative flex w-full md:col-span-6",children:e.jsx(Q,{className:"w-full",type:"bar",data:x,options:s})})]})]}),e.jsxs(I,{className:"flex w-full flex-col",children:[e.jsx("div",{className:"my-2 flex flex-row justify-between p-3",children:e.jsx("div",{className:"flex items-center",children:"Search Component"})}),e.jsx(J,{dataHandler:C,id:"team_reimbursement_requests",headers:M,ref:n})]}),e.jsx(se,{visible:a,onHide:()=>c(!1),expenseData:g,tableRef:n,onSuccess:()=>f(!1)}),e.jsx(te,{visible:E,onHide:()=>{f(!1)},onReject:()=>c(!0),expenseData:g,tableRef:n,onApprove:()=>f(!1)})]})};export{ve as default};
