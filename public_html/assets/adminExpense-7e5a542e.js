import{$ as A,j as e,f as I,af as q,r as t,G as v}from"./index-3ec7abe5.js";import{C as k,D as L}from"./dropdown.esm-1ad10373.js";import{T as B}from"./index-c74eb1f3.js";import{h as O,i as M,j as V,k as $}from"./api-41c2d9cf.js";import{T as P}from"./index-b2a6305f.js";import{a as W}from"./index.esm-66734f9f.js";import{C as E}from"./index-3d6f48ca.js";import{B as T}from"./index-36dd5a0c.js";import{u as G,r as Q}from"./validationSchemas-9cdf4188.js";import{I as H}from"./inputtextarea.esm-51dfddb5.js";import{L as i}from"./index-37ade0e2.js";import{I as c}from"./inputtext.esm-e49a03d7.js";import"./index.esm-9e3aa09b.js";import"./paginator.esm-634e02d4.js";import"./iconBase-2780a5a8.js";const z=({visible:r,onHide:j,tableRef:u,expenseData:s,onSuccess:p})=>{var N,h;const a=G({initialValues:{comment:""},validationSchema:Q(),onSubmit:async f=>{const b=await O(s.id,f);b.status===200&&(d(),A.success(b.message),u.current.refreshListData(),p())},enableReinitialize:!0}),d=()=>{j()},w=[{label:"No",onClick:d,className:"px-3 py-2 w-fit p-button-link"},{label:"Yes",severity:"danger",loading:a.isSubmitting,onClick:a.handleSubmit,className:"px-3 py-2 w-fit"}];return e.jsx(T,{className:"md:w-[30%]",header:"Rejection Confirmation",visible:r,onHide:d,actions:w,children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsxs("p",{children:["Reject expense request for ",e.jsx("span",{className:"font-bold",children:(h=(N=s==null?void 0:s.expense)==null?void 0:N.user)==null?void 0:h.employee_name}),"?"]}),e.jsx(i,{required:!0,title:"Reason",htmlFor:"comment",showError:a.errors.comment&&a.touched.comment,errorMessages:a.errors.comment,children:e.jsx(H,{name:"comment",rows:2,autoResize:!0,className:I("w-full",{"p-invalid text-red-500":a.errors.comment&&a.touched.comment}),onChange:f=>{a.setFieldValue("comment",f.target.value)}})})]})})},J=({visible:r,onHide:j,tableRef:u,expenseData:s,onReject:p,onApprove:a})=>{var f,b,g,y;const d=()=>{j()},h=[{label:"Approve",onClick:async()=>{let x;const _=async C=>{x=await M(C),x.status===200&&(A.success(x.message),u.current.refreshListData(),a())};return q({draggable:!1,resizable:!1,message:"Do you want to approve this expense?",header:"Approval Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>_(s.id),reject:()=>{}})},className:"px-3 py-2 w-fit"},{label:"Reject",severity:"danger",onClick:x=>{p()},className:"px-3 py-2 w-fit"}];return e.jsx(T,{className:"md:w-[30%]",header:"Expense Details",visible:r,onHide:d,actions:h,children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-3 m-auto w-full",children:[e.jsx(i,{title:"Purpose",className:"font-semibold",children:e.jsx(c,{value:(f=s==null?void 0:s.expencesPurpuse)==null?void 0:f.name,disabled:!0})}),e.jsx(i,{title:"Category",className:"font-semibold",children:e.jsx(c,{value:(b=s==null?void 0:s.expencesCategory)==null?void 0:b.category_name,disabled:!0})}),e.jsx(i,{title:"Merchant Name",className:"font-semibold",children:e.jsx(c,{value:s==null?void 0:s.merchant_name,disabled:!0})}),e.jsx(i,{title:"Amount",className:"font-semibold",children:e.jsx(c,{value:s==null?void 0:s.amount,disabled:!0})}),e.jsx(i,{title:"Transaction Date",className:"font-semibold",children:e.jsx(c,{value:s==null?void 0:s.transaction_date,disabled:!0})}),e.jsx(i,{title:"Bill No",className:"font-semibold",children:e.jsx(c,{value:s!=null&&s.bill_no?(g=s==null?void 0:s.expense)==null?void 0:g.bill_no:"NA",disabled:!0})}),(s==null?void 0:s.category_id)==1&&e.jsxs(e.Fragment,{children:[e.jsx(i,{title:"Start Date",className:"font-semibold",children:e.jsx(c,{value:s==null?void 0:s.stay_from_date,disabled:!0})}),e.jsx(i,{title:"End Date",className:"font-semibold",children:e.jsx(c,{value:s==null?void 0:s.stay_to_date,disabled:!0})})]}),((y=s==null?void 0:s.expense)==null?void 0:y.category_id)==3&&e.jsxs(e.Fragment,{children:[e.jsx(i,{title:"From",className:"font-semibold",children:e.jsx(c,{value:s==null?void 0:s.from_location,disabled:!0})}),e.jsx(i,{title:"To",className:"font-semibold",children:e.jsx(c,{value:s==null?void 0:s.to_location,disabled:!0})}),e.jsx(i,{title:"Total Distance",className:"font-semibold",children:e.jsx(c,{value:`${s==null?void 0:s.total_distance} km`,disabled:!0})})]}),e.jsx(i,{title:"Note",className:"font-semibold col-span-2",children:e.jsx(H,{value:s==null?void 0:s.note,disabled:!0,className:"w-full"})})]})})},K=()=>{const r=t.useRef(null);t.useState({}),t.useState({});const[j,u]=t.useState(!1),[s,p]=t.useState(null);t.useState(null),t.useState(0),t.useState(0),t.useState(0);const[a,d]=t.useState(!1),[w,N]=t.useState(null),[h,f]=t.useState(null),[b,g]=t.useState("");t.useState("");const y=async l=>{var n,m;const o=await V();if(o.status==200){const R=(m=(n=o==null?void 0:o.data)==null?void 0:n.data)==null?void 0:m.filter(S=>S.id!==1).map(S=>({code:S.id,label:S.name}));N(R)}},x=async l=>await $({page:l.page+1,records:l.rows,sortBy:l.sortField?l.sortField:"",sortOrder:l.sortField?l.sortOrder===-1?"DESC":"ASC":"",status:h}),_=l=>{p(l),d(!0)},C=async l=>{let o;const n=async m=>{o=await M(m),o.status===200&&(A.success(o.message),r.current.refreshListData())};return q({draggable:!1,resizable:!1,message:"Do you want to approve this expense?",header:"Approval Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>n(l.id),reject:()=>{}})},Y=l=>{p(l),u(!0)},F=[{field:"request_date",header:"Applied On",sortable:!0,body:l=>v(l.request_date).format("ddd, MMM DD, YYYY")},{field:"requester",header:"Requester",sortable:!0,body:l=>e.jsx("p",{children:l.user.employee_name})},{field:"bill_date",header:"Transaction Date",sortable:!0,body:l=>v(l.transaction_date).format("ddd, MMM DD, YYYY")},{field:"bill_number",header:"Bill No.",body:l=>l.bill_no},{field:"price",header:"Price",body:l=>`â‚¹${l.amount}`},{field:"supporting_docs",header:"Supporting Docs",sortable:!0,body:l=>l.document?downloadAction(l):"---"},{field:"note",header:"Notes",body:l=>l.note||"---"},{field:"status",header:"Status",body:l=>{var o,n,m;return e.jsxs("div",{className:"inline-flex items-center justify-center gap-[0.375rem]",children:[e.jsx("div",{className:`h-[0.75rem] w-[0.75rem] rounded-[0.125rem] bg-[${(o=l==null?void 0:l.expencesApprovalStatus)==null?void 0:o.button_hex_color}] border-[${(n=l==null?void 0:l.expencesApprovalStatus)==null?void 0:n.border_hex_color}] border`}),e.jsx("span",{className:"text-sm",children:(m=l==null?void 0:l.expencesApprovalStatus)==null?void 0:m.name})]})}},{field:"actions",header:"Actions",alignHeader:"center",body:l=>{var o,n,m,R;return l.status_id==2?e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row justify-center",children:[e.jsx(W,{className:"text-4xl cursor-pointer",onClick:()=>_(l)}),e.jsx(E,{onClick:()=>C(l),className:"w-full text-sm hover:scale-110 md:w-fit",outlined:!0,label:"Approve",severity:"success"}),e.jsx(E,{onClick:()=>Y(l),className:"w-full text-sm hover:scale-110 md:w-fit",outlined:!0,label:"Reject",severity:"danger"})]}):e.jsxs("div",{className:"ap-3 md:flex-row text-center",children:[e.jsxs("p",{children:[(o=l==null?void 0:l.ExpenseRequestHistories[0])==null?void 0:o.action," by ",(m=(n=l==null?void 0:l.ExpenseRequestHistories[0])==null?void 0:n.user)==null?void 0:m.employee_name]}),e.jsx("p",{children:v((R=l==null?void 0:l.ExpenseRequestHistories[0])==null?void 0:R.createdAt).format("YYYY-MM-DD, HH:mm:ss")})]})}}];return t.useEffect(()=>{y()},[]),e.jsxs("div",{children:[e.jsxs(k,{className:"flex w-full flex-col",children:[e.jsx("div",{className:"my-2 flex flex-row justify-between p-3",children:e.jsx("div",{className:"text-bold flex w-full px-2 pb-4 text-xl text-gray-600",children:"E	xpense Requests"})}),e.jsx("div",{className:"my-2 flex flex-col justify-between p-3 md:flex-row",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 md:flex-row",children:[e.jsx(c,{placeholder:"Search requester name",value:b,onChange:l=>g(l.target.value)}),e.jsx(L,{placeholder:"Status",className:"w-full md:!w-fit",options:w,optionLabel:"label",optionValue:"code",value:h,onChange:l=>{f(l.value)}}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(E,{icon:"pi pi-times",severity:"danger",onClick:()=>{f(null),g(""),r.current&&r.current.refreshListData()}}),e.jsx(E,{icon:"pi pi-search",disabled:!b&&!h,onClick:()=>{r.current&&r.current.refreshListData()}})]})]})}),e.jsx(P,{dataHandler:x,id:"team_reimbursement_requests",headers:F,ref:r})]}),e.jsx(z,{visible:j,onHide:()=>u(!1),expenseData:s,tableRef:r,onSuccess:()=>d(!1)}),e.jsx(J,{visible:a,onHide:()=>{d(!1)},onReject:()=>u(!0),expenseData:s,tableRef:r,onApprove:()=>d(!1)})]})},me=()=>{const[r,j]=t.useState(0),u=[{id:1,label:"Expense Requests"}];return e.jsx("div",{className:"grid w-full",children:e.jsxs(k,{className:"flex w-full flex-col gap-5 overflow-hidden md:col-span-6",children:[e.jsx(B,{activeIndex:r,onTabChange:s=>j(s.index),model:u}),r===0&&e.jsx(K,{})]})})};export{me as default};
