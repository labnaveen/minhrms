import{r as n,G as o,v as E,bW as V,$ as N,bX as S,j as s,f as h,af as k}from"./index-3ec7abe5.js";import{C as L}from"./dropdown.esm-1ad10373.js";import{T as I}from"./index-b2a6305f.js";import{E as B}from"./edit-c01b3e15.js";import{P as O}from"./plus-b36a0702.js";import{T as R}from"./trash-4a28e917.js";import{C as w}from"./index-3d6f48ca.js";import{u as T,s as H}from"./validationSchemas-9cdf4188.js";import{I as D}from"./inputtext.esm-e49a03d7.js";import{B as U}from"./index-36dd5a0c.js";import{L as p}from"./index-37ade0e2.js";import{C as v}from"./calendar.esm-f987a87a.js";import{I as C}from"./inputswitch.esm-65362ee3.js";import{V as G,W as q,X as W,Y as P,Z as X,_ as $}from"./api-9d9fddec.js";import{M as K}from"./multiselect.esm-15dd71d0.js";import{u as F}from"./useDispatch-1aeda00f.js";import"./index.esm-9e3aa09b.js";import"./paginator.esm-634e02d4.js";import"./index.esm-be3d6ae7.js";const Q=({visible:l,onHide:d,tableRef:f})=>{var y;const x=F(),[u]=n.useState(o().format("YYYY-MM-DD")),i=E(V),[r,g]=n.useState(null),[_,j]=n.useState([]),[m,t]=n.useState([]),Y=async a=>{const c=await W(a);c.status===200?(g(c.data.data),t(c.data.data.division_units)):(g(null),t([]))},b=async()=>{const a=await P();j(a.status===200?a.data.data:[])},e=T({initialValues:{title:(r==null?void 0:r.title)||"",description:(r==null?void 0:r.description)||"",suspendable:(r==null?void 0:r.suspendable)||!1,start_date:(r==null?void 0:r.start_date)||u,end_date:(r==null?void 0:r.end_date)||u,group_specific:(r==null?void 0:r.group_specific)||!1,units:[]},validationSchema:H,onSubmit:async a=>{let c;i?c=await q(i,a):c=await G(a),(c.status===201||c.status===200)&&(M(),N.success(c.message),f.current.refreshListData())},enableReinitialize:!0}),A=[{label:i?"Update":"Add",onClick:e.handleSubmit,className:"min-w-[90px]",loading:e.isSubmitting}],M=()=>{x(S("")),e.resetForm(),g(null),t([]),d(!1)};return n.useEffect(()=>{l&&b()},[l]),n.useEffect(()=>{l&&i&&Y(i)},[l,i]),n.useEffect(()=>{l&&e.setFieldValue("units",(m==null?void 0:m.map(a=>a.id))||[])},[l,m]),s.jsx(U,{header:`${i?"Update":"Add New"} Announcement`,visible:l,onHide:M,actions:A,children:s.jsxs("div",{className:"m-auto grid w-full gap-3 md:grid-cols-2",children:[s.jsx(p,{required:!0,title:"Title",showError:e.errors.title&&e.touched.title,errorMessages:e.errors.title,children:s.jsx(D,{name:"title",value:e.values.title,className:h("w-full",{"p-invalid text-red-500":e.errors.title&&e.touched.title}),onChange:a=>e.setFieldValue("title",a.target.value)})}),s.jsx(p,{required:!0,title:"Description",showError:e.errors.description&&e.touched.description,errorMessages:e.errors.description,children:s.jsx(D,{name:"description",value:e.values.description,className:h("w-full",{"p-invalid text-red-500":e.errors.description&&e.touched.description}),onChange:a=>e.setFieldValue("description",a.target.value)})}),s.jsx(p,{title:"Suspendable Announcement?",className:"md:col-span-2",children:s.jsx(C,{name:"suspendable",checked:e.values.suspendable,onChange:a=>{e.setFieldValue("suspendable",a.value),a.value?(e.setFieldValue("start_date",u),e.setFieldValue("end_date",u)):(e.setFieldValue("start_date",""),e.setFieldValue("end_date",""))}})}),e.values.suspendable&&s.jsxs(s.Fragment,{children:[s.jsx(p,{title:"Start Date",required:!0,showError:e.errors.start_date&&e.touched.start_date,errorMessages:e.errors.start_date,children:s.jsx(v,{dateFormat:"dd-mm-yy",readOnlyInput:!0,minDate:o(u,"YYYY-MM-DD").toDate(),disabled:i&&o().isSameOrAfter(o(e.values.start_date,"YYYY-MM-DD")),value:o(e.values.start_date,"YYYY-MM-DD").toDate(),className:h("w-full",{"p-invalid text-red-500":e.errors.start_date&&e.touched.start_date}),onChange:a=>{e.setFieldValue("start_date",o(a.value).format("YYYY-MM-DD")),e.setFieldValue("end_date",o(a.value).format("YYYY-MM-DD"))}})}),s.jsx(p,{title:"End Date",required:!0,showError:e.errors.end_date&&e.touched.end_date,errorMessages:e.errors.end_date,children:s.jsx(v,{dateFormat:"dd-mm-yy",readOnlyInput:!0,minDate:o((y=e.values)==null?void 0:y.start_date,"YYYY-MM-DD").toDate(),value:o(e.values.end_date,"YYYY-MM-DD").toDate(),className:h("w-full",{"p-invalid text-red-500":e.errors.end_date&&e.touched.end_date}),onChange:a=>e.setFieldValue("end_date",o(a.value).format("YYYY-MM-DD"))})})]}),s.jsx(p,{title:"Group Specific?",children:s.jsx(C,{name:"group_specific",checked:e.values.group_specific,onChange:a=>{e.setFieldValue("group_specific",a.value),e.setFieldValue("units",[])}})}),e.values.group_specific&&s.jsx(p,{className:"md:col-span-2",title:"Select organisational units",showError:e.errors.units&&e.touched.units,errorMessages:e.errors.units,children:s.jsx(K,{dataKey:"id",name:"division_units",options:_,optionLabel:"unit_name",optionGroupLabel:"division_name",optionGroupChildren:"division_units",filter:!0,resetFilterOnHide:!0,showClear:!0,display:"chip",placeholder:"Select Division Units",value:m,onChange:a=>t(a.value),className:h("w-full",{"p-invalid text-red-500":e.errors.units&&e.touched.units}),pt:{label:{className:"flex !gap-1 flex-wrap mr-3"},token:{className:"w-max max-h-[2rem] !rounded-[0.25rem] !bg-[#37B3E0] !text-white py-1 px-2 text-sm m-0"}}})})]})})},xe=()=>{const l=F(),d=n.useRef(null),[f,x]=n.useState(""),[u,i]=n.useState(!1),r=async t=>await X({filterBy:"search_term",filterValue:f,page:t.page+1,records:t.rows,sortBy:t.sortField?t.sortField:"",sortOrder:t.sortField?t.sortOrder===-1?"DESC":"ASC":""}),_=[{field:"title",header:"Title",sortable:!0,body:t=>t.title},{field:"description",header:"Description",body:t=>t.description},{field:"group_specific",header:"Group Specific",body:t=>t!=null&&t.group_specific?"Yes":"No"},{field:"suspendable",header:"Suspendable",body:t=>t!=null&&t.suspendable?"Yes":"No"},{field:"end_date",header:"End Date",sortable:!0,body:t=>t!=null&&t.end_date?o(t.end_date).format("DD MMM yyyy"):"N/A"},{field:"actions",align:"center",alignHeader:"center",className:"cursor-default",header:"Actions",body:t=>s.jsxs("div",{className:"flex w-full items-center justify-center gap-3",children:[s.jsx("img",{className:"cursor-pointer",width:25,height:25,src:B,onClick:()=>{l(S(t.id)),i(!0)}}),s.jsx("img",{className:"cursor-pointer",width:25,height:25,src:R,onClick:()=>j(t)})]})}],j=t=>{const Y=async b=>{const e=await $(b);e.status===200&&(N.success(e.message),d.current.refreshListData())};return k({draggable:!1,resizable:!1,message:"Do you want to delete this record?",header:"Delete Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",rejectClassName:"p-button-link mr-2",accept:()=>Y(t.id),reject:()=>{}})},m=()=>{i(!0)};return s.jsxs("div",{className:"flex w-full flex-col",children:[s.jsx("div",{className:"text-bold flex w-full px-2 pb-4 text-xl text-gray-600",children:"Announcements"}),s.jsxs(L,{className:"flex w-full flex-col",children:[s.jsxs("div",{className:"my-2 flex flex-col-reverse justify-between gap-3 p-3 md:flex-row",children:[s.jsxs("div",{className:"flex flex-col items-center gap-3 md:flex-row",children:[s.jsx(D,{placeholder:"Search title",value:f,onChange:t=>x(t.target.value)}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(w,{icon:"pi pi-times",severity:"danger",onClick:()=>{x(""),d.current&&d.current.refreshListData()}}),s.jsx(w,{icon:"pi pi-search",disabled:!f,onClick:()=>{d.current&&d.current.refreshListData()}})]})]}),s.jsx(w,{raised:!0,label:"Create Announcement",icon:s.jsx("img",{src:O}),onClick:m})]}),s.jsx(I,{dataHandler:r,id:"asset_list",headers:_,ref:d})]}),s.jsx(Q,{visible:u,onHide:()=>i(!1),tableRef:d})]})};export{xe as default};
